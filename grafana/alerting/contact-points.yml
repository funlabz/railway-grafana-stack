apiVersion: 1

contactPoints:
  # -------------------------
  # Flow errors → engineering Slack
  # -------------------------
  - orgId: 1
    name: polybot-flow-slack
    receivers:
      - uid: polybot_flow_slack
        type: slack
        disableResolveMessage: false
        settings:
          recipient: "${POLYBOT_SLACK_CHANNEL}"
          url: "${POLYBOT_SLACK_WEBHOOK_URL}"
          title: '{{ if .CommonLabels.alertname }}{{ .CommonLabels.alertname }}{{ else }}Grafana Alert{{ end }}'
          text: |
            {{- range .Alerts }}
            *Alert:* {{ if .Labels.alertname }}{{ .Labels.alertname }}{{ else }}Grafana Alert{{ end }}
            *Severity:* {{ if .Labels.severity }}{{ .Labels.severity }}{{ else }}n/a{{ end }}
            *Component:* {{ if .Labels.component }}{{ .Labels.component }}{{ else }}n/a{{ end }}
            {{- if .GeneratorURL }}
            *Alert URL:* <{{ .GeneratorURL }}|Open alert view>
            {{- end }}

            {{- if .Labels.metric }}
            *Payload:* {{ .Labels.metric }}
            {{- end }}

            {{- if .Annotations.details }}
            *Details:* {{ .Annotations.details }}
            {{- end }}
            {{- end }}
          color: '{{ if eq .CommonLabels.severity "critical" }}#E02F44{{ else if or (eq .CommonLabels.severity "error") (eq .CommonLabels.severity "warning") }}#FFB347{{ else }}#36A64F{{ end }}'

  # -------------------------
  # Trades → business Slack
  # -------------------------
  - orgId: 1
    name: polybot-trade-slack
    receivers:
      - uid: polybot_trade_slack
        type: slack
        disableResolveMessage: false
        settings:
          recipient: "${POLYBOT_BUSINESS_SLACK_CHANNEL}"
          url: "${POLYBOT_BUSINESS_SLACK_WEBHOOK_URL}"
          title: '{{ if .CommonLabels.alertname }}{{ .CommonLabels.alertname }}{{ else }}Grafana Alert{{ end }}'
          text: |
            {{- range .Alerts }}
            *Alert:* {{ if .Labels.alertname }}{{ .Labels.alertname }}{{ else }}Grafana Alert{{ end }}
            *Severity:* {{ if .Labels.severity }}{{ .Labels.severity }}{{ else }}n/a{{ end }}
            *Component:* {{ if .Labels.component }}{{ .Labels.component }}{{ else }}n/a{{ end }}
            {{- if .GeneratorURL }}
            *Alert URL:* <{{ .GeneratorURL }}|Open alert view>
            {{- end }}

            {{- if .Labels.user_handle }}
            *Handle:* {{ .Labels.user_handle }}
            {{- end }}
            {{- if .Labels.market_slug }}
            *Market:* {{ .Labels.market_slug }}
            {{- end }}
            {{- if .Labels.amount_usd }}
            *Amount (USD):* {{ .Labels.amount_usd }}
            {{- end }}
            {{- if .Labels.user_id }}
            *User ID:* {{ .Labels.user_id }}
            {{- end }}

            {{- if .Annotations.summary }}
            *Summary:* {{ .Annotations.summary }}
            {{- end }}
            {{- if .Annotations.details }}
            *Details:* {{ .Annotations.details }}
            {{- end }}
            {{- end }}
          color: '{{ if eq .CommonLabels.severity "critical" }}#E02F44{{ else if or (eq .CommonLabels.severity "error") (eq .CommonLabels.severity "warning") }}#FFB347{{ else }}#36A64F{{ end }}'

  # -------------------------
  # New users → business Slack
  # -------------------------
  - orgId: 1
    name: polybot-user-slack
    receivers:
      - uid: polybot_user_slack
        type: slack
        disableResolveMessage: false
        settings:
          recipient: "${POLYBOT_BUSINESS_SLACK_CHANNEL}"
          url: "${POLYBOT_BUSINESS_SLACK_WEBHOOK_URL}"
          title: '{{ if .CommonLabels.alertname }}{{ .CommonLabels.alertname }}{{ else }}Grafana Alert{{ end }}'
          text: |
            {{- range .Alerts }}
            *Alert:* {{ if .Labels.alertname }}{{ .Labels.alertname }}{{ else }}Grafana Alert{{ end }}
            *Severity:* {{ if .Labels.severity }}{{ .Labels.severity }}{{ else }}n/a{{ end }}
            *Component:* {{ if .Labels.component }}{{ .Labels.component }}{{ else }}n/a{{ end }}
            {{- if .GeneratorURL }}
            *Alert URL:* <{{ .GeneratorURL }}|Open alert view>
            {{- end }}

            {{- if .Labels.user_count_str }}
            *New users:* {{ .Labels.user_count_str }}
            {{- end }}
            {{- if .Labels.users }}
            *Users:* {{ .Labels.users }}
            {{- end }}

            {{- if .Annotations.summary }}
            *Summary:* {{ .Annotations.summary }}
            {{- end }}
            {{- if .Annotations.details }}
            *Details:* {{ .Annotations.details }}
            {{- end }}
            {{- end }}
          color: '{{ if eq .CommonLabels.severity "critical" }}#E02F44{{ else if or (eq .CommonLabels.severity "error") (eq .CommonLabels.severity "warning") }}#FFB347{{ else }}#36A64F{{ end }}'
