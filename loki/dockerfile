ARG VERSION=3.4

FROM grafana/loki:${VERSION}

# Copy the loki.yml configuration file to the container
COPY loki.yml /etc/loki/loki-config.yaml

# Ensure required storage directories exist and are writable by the loki user (10001)
RUN mkdir -p /loki/chunks /loki/tsdb-index /loki/tsdb-cache && \
    chown -R 10001:10001 /loki

# Railway detects service ports from EXPOSE; publish HTTP and gRPC
EXPOSE 3100 9095

# Command to run Loki
CMD ["-config.file=/etc/loki/loki-config.yaml"]
