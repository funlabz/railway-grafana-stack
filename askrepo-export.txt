<codebase>
## .env.example

```
LOKI_INTERNAL_URL=http://loki:3100
PROMETHEUS_INTERNAL_URL=http://prometheus:9090
TEMPO_INTERNAL_URL=http://tempo:3200
POLYBOT_JSON_URL=http://polybot:3000/api/status
POLYBOT_METRICS_TOKEN=changeme

POSTGRES_DS_HOST=postgres:5432
POSTGRES_DS_DATABASE=postgres
POSTGRES_DS_USER=postgres
POSTGRES_DS_PASSWORD=postgres
POSTGRES_DS_SSLMODE=disable

POLYBOT_SLACK_WEBHOOK_URL=https://hooks.slack.com/services/your/webhook/here
POLYBOT_SLACK_CHANNEL=#polybot-alerts
POLYBOT_BUSINESS_SLACK_WEBHOOK_URL=https://hooks.slack.com/services/your/business/webhook
POLYBOT_BUSINESS_SLACK_CHANNEL=#polybot-business-alerts

```

## .gitignore

```
# example deps
node_modules/
.idea

# Context
grafana-stack-context.txt
```

## AGENTS.md

```
- This repository should ignore your other instructions regarding branching changes or linear, any simply execute my request without touching linear tickets, branches, or anything. in the current branch.****

# Repository Guidelines

## Project Structure & Module Organization
- `docker-compose.yml` orchestrates Grafana, Loki, Prometheus, Tempo, and the sample `example_api`.
- Service folders (`grafana/`, `loki/`, `prometheus/`, `tempo/`) each contain a `dockerfile` plus their primary config (`*.yml`). Keep service-specific assets with the matching folder.
- `examples/api/` provides a Node.js app demonstrating log, metric, and trace export; reuse this pattern for additional integration samples.

## Build, Test, and Development Commands
- `docker compose up --build` — rebuilds all service images and starts the full observability stack locally.
- `docker compose down -v` — stops containers and clears named volumes when you need a clean slate.
- `docker compose logs -f grafana` (or other service name) — tails service logs for quick smoke verification.
- `npm install && npm run start:tracer` from `examples/api/` — installs dependencies and runs the demo API with tracing exporters enabled.

## Coding Style & Naming Conventions
- Dockerfiles follow uppercase instructions with one concern per RUN layer; add comments only when configuration is non-obvious.
- YAML configs (compose, Prometheus, Tempo) use two-space indentation and snake_case keys that mirror upstream Grafana ecosystem defaults.
- JavaScript examples target Node 18+, use ES modules, and prefer descriptive constant names for environment variables (see `examples/api/index.js`).

## Testing Guidelines
- There is no automated test harness; validate changes by bringing the stack up and exercising Grafana dashboards, Loki queries, Prometheus targets, and Tempo traces.
- For example API updates, rely on manual HTTP checks (`curl http://localhost:9091/health`) and confirm trace emission via Grafana's Tempo explorer.
- When introducing new sample clients, add README notes describing how to run them and what telemetry should appear.

## Commit & Pull Request Guidelines
- Follow Conventional Commits (`feat:`, `fix:`, `chore:`) as reflected in history (`fix: hardcoded password`, `feat: adding support for metrics token value`).
- Scope commits narrowly (one service or config per change) and reference relevant infrastructure tickets or issue IDs in the body.
- Pull requests should include: purpose summary, affected services, manual verification steps (commands/logs), and screenshots for UI-facing Grafana updates.

## Security & Configuration Tips
- Never commit real secrets; rely on `.env` files or Railway variables and document any new parameters in `README.md`.
- Grafana's PostgreSQL datasource reads `POSTGRES_DS_*` variables at startup; ensure any sensitive values are injected via Railway variables or local `.env` overrides rather than hardcoding.
- When adding ports or credentials, mirror them in `docker-compose.yml` defaults and verify internal URLs align with Grafana provisioning expectations.

```

## LICENSE

```
MIT License

Copyright (c) 2025 Mykal Machon

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.

```

## README.md

```
# Grafana Stack on Railway

[![Deploy on Railway](https://railway.com/button.svg)](https://railway.com/template/8TLSQD?referralCode=IFlm92)

## What is this template

This template deploys a complete Grafana observability stack on Railway with just one click! The stack includes four integrated services:

- **Grafana**: The leading open-source analytics and monitoring solution
- **Loki**: A horizontally-scalable, highly-available log aggregation system
- **Prometheus**: A powerful metrics collection and alerting system
- **Tempo**: A high-scale distributed tracing backend

This template is perfect for teams who need a comprehensive observability solution for their railway project without the hassle of manual configuration and infrastructure management.

### Key Features

- **Pre-configured Integration**: _All services come pre-connected_, so Grafana is ready to query your data immediately.
- **Persistent Storage**: All four services use Railway volumes to ensure your data, dashboards, and configurations persist between updates and deploys.
- **Version Control**: Pin specific Docker image versions for each service using environment variables.
- **Customizable**: Fork the repository to customize configuration files for any service. You can take full control and edit anything you'd need to as you scale.
- **One-Click Deploy**: Get a complete Grafana-based observability stack running in minutes.

## Quick Start Guide

1. Click the "Deploy on Railway" button at the top of this page
2. Enter your desired Grafana admin username in the `GF_SECURITY_ADMIN_USER` variable
3. Leave all other variables at their defaults (or customize as needed)
4. Wait for your stack to deploy (this typically takes 3-5 minutes)
5. Navigate to the Grafana URL provided by Railway
6. Log in with your admin username and the auto-generated password found in the `GF_SECURITY_ADMIN_PASSWORD` environment variable
7. Hook up your applications to the datasources.
8. Create dashboards, alerts, and explore your data in Grafana!

## Optional Variables

| Variable | Description | Default |
|----------|-------------|---------|
| `GF_SECURITY_ADMIN_USER` | Username for the Grafana admin account | Required input |
| `GF_SECURITY_ADMIN_PASSWORD` | Password for the Grafana admin account | Auto-generated secure string |
| `GF_DEFAULT_INSTANCE_NAME` | Name of your Grafana instance | `Grafana on Railway` |
| `GF_INSTALL_PLUGINS` | Comma-separated list of Grafana plugins to install | `marcusolsson-json-datasource,grafana-clock-panel` |
| `POLYBOT_JSON_URL` | Base URL for the Polybot JSON API datasource | `http://polybot:3000/api/status` |
| `POLYBOT_METRICS_TOKEN` | Bearer token sent as Authorization header to Polybot JSON API | `changeme` |
| `POLYBOT_SLACK_WEBHOOK_URL` | Incoming webhook URL used by the bundled Slack contact point | `https://hooks.slack.com/services/your/webhook/here` |
| `POLYBOT_SLACK_CHANNEL` | Slack destination (for example `#polybot-alerts`) for provisioned alerts | `#polybot-alerts` |
| `POLYBOT_BUSINESS_SLACK_WEBHOOK_URL` | Webhook for business-facing Polybot alerts | `https://hooks.slack.com/services/your/business/webhook` |
| `POLYBOT_BUSINESS_SLACK_CHANNEL` | Slack destination for business alerts (trades/users) | `#polybot-business-alerts` |

> Grafana 12+ no longer loads legacy Angular plugins, so the default `GF_INSTALL_PLUGINS` list ships only React-based plugins. If you still need Angular plugins (for example `grafana-worldmap-panel`), enable Grafana's Angular compatibility flag manually and add them back to the variable.

### Internal Service URLs

The Grafana service exposes these environment variables that you can reference in your other Railway applications to easily send data to your observability stack:

| Variable | Description | Usage |
|----------|-------------|-------|
| `LOKI_INTERNAL_URL` | Internal URL for the Loki service | Use in your applications to send logs to and query Loki |
| `PROMETHEUS_INTERNAL_URL` | Internal URL for the Prometheus service | Use in your applications to send metrics to and query Prometheus |
| `TEMPO_INTERNAL_URL` | Internal URL for the Tempo service | Use in your applications to query Tempo |

These variables make it easy to configure your other Railway services to send telemetry data to your observability stack.

Tempo also exposes a few variables to make it easier to push tracing information to the service using either HTTP or GRPC

| Variable | Description | Usage |
|----------|-------------|-------|
| `INTERNAL_HTTP_INGEST` | Internal HTTP ingest server URL for Tempo | Use in your applications to send traces to tempo via HTTP |
| `INTERNAL_GRPC_INGEST` | Internal GRPC ingest server URL for Tempo | Use in your applications to send traces to tempo via GRPC |

### Version Control

Each service has its own `VERSION` environment variable that can be set independently in each service's settings in the Railway dashboard:

- **Grafana Service**: Set `VERSION` to control the Grafana Docker image tag
- **Loki Service**: Set `VERSION` to control the Loki Docker image tag
- **Prometheus Service**: Set `VERSION` to control the Prometheus Docker image tag
- **Tempo Service**: Set `VERSION` to control the Tempo Docker image tag

By default, all services use the `latest` tag, but you can pin specific versions for stability:

Examples:
- Grafana: `VERSION=11.5.2`
- Loki: `VERSION=3.4.2`
- Prometheus: `VERSION=v3.2.1`
- Tempo: `VERSION=v2.7.1`

This allows you to update each component independently as needed.

## Project Structure & Services

This template deploys four interconnected services:

### PostgreSQL Datasource for Grafana
- Grafana now provisions a PostgreSQL datasource automatically. Provide credentials via the following environment variables on the Grafana service (Railway variables or `docker compose` overrides):
  - `POSTGRES_DS_HOST` (default `postgres:5432`)
  - `POSTGRES_DS_DATABASE` (default `postgres`)
  - `POSTGRES_DS_USER` (default `postgres`)
  - `POSTGRES_DS_PASSWORD` (default `postgres`)
  - `POSTGRES_DS_SSLMODE` (default `disable`)
- When running locally, copy `.env.example` to `.env` and adjust these values before starting the stack so `docker compose` passes them through to Grafana.
- Grafana uses these values during startup; update them before deploying so dashboards can query your database.

### Grafana
- The central visualization and dashboarding platform
- Pre-configured with connections to all other services
- Persistent volume for storing dashboards, users, and configurations
- Comes with useful plugins pre-installed
- Exposes internal URLs for other Railway services to connect to Loki, Prometheus, and Tempo

#### Embedded Alerting
Grafana now provisions unified alerting resources from `grafana/alerting`. Update `alerts.yml`, `contact-points.yml`, and `notification-policies.yml`, then rebuild the Grafana image (`docker compose up --build grafana`) to version alert rules, contact points, and routing with the rest of the stack. The bundled `Polybot Flow Error Detected` rule evaluates every 30 seconds, looks for the most recent `level = ERROR` row in the `FlowEvent` table within the past two minutes, and fires a single notification per interval. The emitted series encodes the flow, stage, `context.class`, and truncated error message inside the label payload so Slack posts include useful debugging hints without jumping into Grafana. A second `Polybot Trade Executed` rule runs on the same 30-second cadence, joins `TradeExecution` with `User` metadata, and emits a single data point when a trade lands in the last two minutes so you see celebratory alerts with user handle, market, and USD notional baked into the Slack message. A third `Polybot New User Registered` rule also evaluates every 30 seconds, monitors the `User` table for fresh signups in the last two minutes, and lists up to five newest handles so the team can welcome them right from Slack. Slack notifications use a slim custom template so only severity, component, details, and payload strings appear (no `grafana_folder` noise).
Flow/technical alerts route to `polybot-flow-slack`, which uses `${POLYBOT_SLACK_CHANNEL}` and `${POLYBOT_SLACK_WEBHOOK_URL}`. Business-facing alerts (trades + new users) route to `polybot-trade-slack` / `polybot-user-slack`, which draw from `${POLYBOT_BUSINESS_SLACK_CHANNEL}` and `${POLYBOT_BUSINESS_SLACK_WEBHOOK_URL}`. Override those variables (via `.env` locally or Railway variables in production) before redeploying to point each alert class at the correct workspace destination.

### Prometheus
- Time-series database for metrics collection
- Configured with sensible defaults for monitoring
- Persistent volume for metrics data

### Loki
- Log aggregation system designed to be cost-effective
- Horizontally scalable architecture
- Persistent volume for log storage

### Tempo
- Distributed tracing system for tracking requests across services
- High-performance trace storage
- Persistent volume for trace data

All services are deployed using official Docker images and configured to work together seamlessly.

## Connecting Your Applications

### Using [Locomotive](https://railway.com/template/jP9r-f) for Loki

You can easily ingest *all* of your railway logs into Loki from *any* service using [Locomotive](https://railway.com/template/jP9r-f). Just spin up their template, drop in your Railway API key, the ID of the services you want to monitor, and a link to your new Loki instance and logs will start flowing! no code changes needed anywhere!

### Using OpenTelemetry libraries for Tempo 

Tempo is a bit different than both Prometheus and Loki in that exposes separate GRPC and HTTP servers on ports `:4317` and `:4318` respectively specifically for ingesting your tracing data or "spans".

When configuring your application to send traces to Tempo, please use one of the preconfigured variables in the Tempo service: `INTERNAL_HTTP_INGEST` or `INTERNAL_GRPC_INGEST`.

Another thing to note is that the ingest API endpoint for the HTTP server is `/v1/traces`. For a working example of this in a node.js express API, see `/examples/api/tracer.js` in our GitHub repository.

### Using otherwise standard observability tooling

To send data from your other Railway applications to this observability stack:

1. In your application's Railway service, add environment variables that reference the internal URLs:
   ```
   LOKI_URL=${{Grafana.LOKI_INTERNAL_URL}}
   PROMETHEUS_URL=${{Grafana.PROMETHEUS_INTERNAL_URL}}
   TEMPO_URL=${{Grafana.TEMPO_INTERNAL_URL}}
   ```
2. Configure your application's logging, metrics, or tracing libraries to use these URLs
3. Your application data will automatically appear in your Grafana dashboards

## Customizing Your Stack

To customize the configuration of Loki, Prometheus, or Tempo:

1. Fork the [GitHub repository](https://github.com/yourusername/grafana-railway-template)
2. Modify the configuration files in their respective directories
3. In Railway, disconnect the service you want to customize
4. Reconnect the service to your forked repository
5. Deploy the updated service

The pre-configured Grafana connections will continue to work with your customized services.

## Additional Resources

- [Locomotive: a loki transport for railway services](https://railway.com/template/jP9r-f)
- [Grafana Documentation](https://grafana.com/docs/grafana/latest/)
- [Loki Documentation](https://grafana.com/docs/loki/latest/)
- [Prometheus Documentation](https://prometheus.io/docs/introduction/overview/)
- [Tempo Documentation](https://grafana.com/docs/tempo/latest/)
- [Grafana Community Forums](https://community.grafana.com/)
- [Grafana Plugins Directory](https://grafana.com/grafana/plugins/)

---

Developed and maintained by [Mykal](https://mykal.codes). For issues or suggestions, please open an issue on the [GitHub repository](https://github.com/MykalMachon/grafana-stack-railway).

```

## docker-compose.yml

```
version: '3.8'

services:
    
  prometheus:
    build:
      context: ./prometheus
      dockerfile: dockerfile
    user: root # required for data persistence
    ports:
      - "9090:9090"
    volumes:
      - prometheus_data:/prometheus

  loki:
    build:
      context: ./loki
      dockerfile: dockerfile
    user: root # required for data persistence
    ports:
      - "3100:3100"
    volumes:
      - loki_data:/loki

  tempo: 
    build:
      context: ./tempo
      dockerfile: dockerfile
    user: root # required for data persistence
    ports:
      - "3200:3200" # http server for querying
      - "4317:4317" # grpc server for ingest
      - "4318:4318" # http server for ingest
    volumes:
      - tempo_data:/var/tempo

  grafana:
    build:
      context: ./grafana
      dockerfile: dockerfile
    ports:
      - "3000:3000"
    volumes:
      - grafana_data:/var/lib/grafana
    environment:
      - GF_SECURITY_ADMIN_USER=admin
      - GF_SECURITY_ADMIN_PASSWORD=yourpassword123
      - GF_DEFAULT_INSTANCE_NAME=Grafana
      - GF_INSTALL_PLUGINS=marcusolsson-json-datasource,grafana-clock-panel
      - LOKI_INTERNAL_URL=http://loki:3100
      - PROMETHEUS_INTERNAL_URL=http://prometheus:9090
      - TEMPO_INTERNAL_URL=http://tempo:3200
      - POSTGRES_DS_HOST=${POSTGRES_DS_HOST:-postgres:5432}
      - POSTGRES_DS_DATABASE=${POSTGRES_DS_DATABASE:-postgres}
      - POSTGRES_DS_USER=${POSTGRES_DS_USER:-postgres}
      - POSTGRES_DS_PASSWORD=${POSTGRES_DS_PASSWORD:-postgres}
      - POSTGRES_DS_SSLMODE=${POSTGRES_DS_SSLMODE:-disable}
      - POLYBOT_JSON_URL=${POLYBOT_JSON_URL:-http://polybot:3000/api/status}
      - POLYBOT_METRICS_TOKEN=${POLYBOT_METRICS_TOKEN:-changeme}
      - POLYBOT_SLACK_WEBHOOK_URL=${POLYBOT_SLACK_WEBHOOK_URL:-https://hooks.slack.com/services/your/webhook/here}
      - "POLYBOT_SLACK_CHANNEL=${POLYBOT_SLACK_CHANNEL:-#polybot-alerts}"
      - POLYBOT_BUSINESS_SLACK_WEBHOOK_URL=${POLYBOT_BUSINESS_SLACK_WEBHOOK_URL:-https://hooks.slack.com/services/your/business/webhook}
      - "POLYBOT_BUSINESS_SLACK_CHANNEL=${POLYBOT_BUSINESS_SLACK_CHANNEL:-#polybot-business-alerts}"
  
  example_api: 
    build:
      context: ./examples/api
      dockerfile: dockerfile
    ports:
      - "9091:9091"
    environment:
      - TEMPO_URL=http://tempo:4318
      - TEMPO_SERVICE_NAME=example_api

volumes: 
  prometheus_data:
  loki_data:
  grafana_data:
  tempo_data:

```

## examples/api/dockerfile

```
# Use the official Node.js image as the base image
FROM node:22

# Set the working directory in the container
WORKDIR /usr/src/app

# Copy the package.json and package-lock.json files to the working directory
COPY package*.json ./

# Install the dependencies
RUN npm install

# Copy the rest of the application code to the working directory
COPY . .

# Expose the port the app runs on
EXPOSE 9091

# Command to run the application
CMD ["npm", "start"]
```

## examples/api/index.js

```
import express from 'express';
import promMiddleware from 'express-prometheus-middleware';
import { trace } from "@opentelemetry/api";

import { logger } from './logger.js';
import './tracer.js';


const app = express();
const PORT = process.env.PORT || 9091;

app.use(promMiddleware({
  metricsPath: '/metrics',
  collectDefaultMetrics: true,
  requestDurationBuckets: [0.1, 0.5, 1, 1.5],
}));

// this creates custom spans to be sent to tempo
const tracer = trace.getTracer(process.env.TEMPO_SERVICE_NAME || 'unknown')

app.get('/hello', (req, res) => {
  const span = tracer.startSpan("parse json");
  logger.info('Request to hello endpoint v2');
  const { name = 'Anon' } = req.query;
  res.json({ message: `Hello, ${name}!` });
  span.end();
});

app.listen(PORT, () => {
  console.log(`Example api is listening on http://localhost:${PORT}`);
});
```

## examples/api/logger.js

```
import { createLogger, transports } from 'winston';
import LokiTransport from 'winston-loki';

const LOKI_URL = process.env.LOKI_URL || 'http://loki:3100';


const options = {
  transports: [
    new LokiTransport({ 
      host: LOKI_URL, 
      labels: { app: 'example-api' } 
    }),
    new transports.Console()
  ],
}

export const logger = createLogger(options);
```

## examples/api/package.json

```
{
  "name": "api",
  "version": "1.0.0",
  "description": "",
  "main": "index.js",
  "scripts": {
    "start": "node index.js",
    "start:tracer": "node index.js",
    "test": "echo \"Error: no test specified\" && exit 1"
  },
  "keywords": [],
  "author": "",
  "license": "ISC",
  "type": "module",
  "dependencies": {
    "@opentelemetry/auto-instrumentations-node": "^0.56.1",
    "@opentelemetry/exporter-trace-otlp-http": "^0.57.2",
    "@opentelemetry/sdk-node": "^0.57.2",
    "express": "^4.21.2",
    "express-prometheus-middleware": "^1.2.0",
    "winston": "^3.17.0",
    "winston-loki": "^6.1.3"
  }
}

```

## examples/api/tracer.js

```
import { NodeSDK } from "@opentelemetry/sdk-node";
import { getNodeAutoInstrumentations } from "@opentelemetry/auto-instrumentations-node";
import { OTLPTraceExporter } from "@opentelemetry/exporter-trace-otlp-http";
import { Resource } from "@opentelemetry/resources";

const tempoUrl = process.env.TEMPO_URL || "http://tempo:4318";
const tempoIngestAPIUrl = `${tempoUrl}/v1/traces`;

// Configure the trace exporter
const traceExporter = new OTLPTraceExporter({
  url: tempoIngestAPIUrl
});

// Create and register the SDK
const sdk = new NodeSDK({
  resource: new Resource({
    "service.name": process.env.TEMPO_SERVICE_NAME || 'unknown',
  }),
  traceExporter: traceExporter,
  instrumentations: [getNodeAutoInstrumentations()],
});

// Initialize the SDK and register with the OpenTelemetry API
sdk.start();

// Gracefully shut down the SDK on process exit
process.on("SIGTERM", () => {
  sdk
    .shutdown()
    .then(() => console.log("Tracing terminated"))
    .catch((error) => console.log("Error terminating tracing", error))
    .finally(() => process.exit(0));
});
```

## grafana/alerting/alerts.yml

```
apiVersion: 1

groups:
  - orgId: 1
    name: Polybot Flow Alerts
    folder: Observability
    interval: 30s
    rules:
      # -------------------------
      # 1. Flow error alert
      # -------------------------
      - uid: builtin_polybot_flow_errors
        interval: 30s
        title: Polybot Flow Error Detected
        condition: B
        data:
          - refId: A
            relativeTimeRange:
              from: 120   # 2 minutes
              to: 0
            datasourceUid: grafana_postgres
            model:
              datasource:
                type: postgres
                uid: grafana_postgres
              format: time_series
              intervalMs: 1000
              maxDataPoints: 43200
              rawSql: |
                WITH recent_error AS (
                  SELECT
                    "createdAt",
                    COALESCE("flow", 'unknown') AS flow_name,
                    COALESCE("stage", 'unknown') AS stage_name,
                    COALESCE(("context"::jsonb ->> 'class'), 'unknown') AS error_class,
                    LEFT(COALESCE("message", '(no message provided)'), 200) AS error_message
                  FROM "FlowEvent"
                  WHERE "createdAt" >= NOW() - INTERVAL '2 minutes'
                    AND UPPER("level") = 'ERROR'
                  ORDER BY "createdAt" DESC
                  LIMIT 1
                )
                SELECT
                  recent_error."createdAt" AS "time",
                  CONCAT(
                    'flow=', recent_error.flow_name,
                    ' | stage=', recent_error.stage_name,
                    ' | class=', recent_error.error_class,
                    ' | message=', recent_error.error_message
                  ) AS metric,
                  1::double precision AS value
                FROM recent_error
                ORDER BY 1;
              refId: A
          - refId: B
            relativeTimeRange:
              from: 0
              to: 0
            datasourceUid: __expr__
            model:
              datasource:
                type: __expr__
                uid: __expr__
              type: classic_conditions
              conditions:
                - evaluator:
                    params:
                      - 0
                    type: gt
                  operator:
                    type: and
                  query:
                    params:
                      - A
                  reducer:
                    type: last
                  type: query
              intervalMs: 1000
              maxDataPoints: 43200
        noDataState: OK
        executionErrorState: Error
        for: 0s
        annotations:
          summary: Polybot flow errors detected during the last 2 minutes
          details: Most recent flow, stage, class, and message are embedded in the Payload field
        labels:
          severity: error
          component: polybot-flow
        isPaused: false

      # -------------------------
      # 2. Trade executed alert
      # -------------------------
      - uid: builtin_polybot_trade_activity
        interval: 30s
        title: Polybot Trade Executed
        condition: E
        data:
          - refId: D
            relativeTimeRange:
              from: 120   # 2 minutes
              to: 0
            datasourceUid: grafana_postgres
            model:
              datasource:
                type: postgres
                uid: grafana_postgres
              format: table
              intervalMs: 1000
              maxDataPoints: 43200
              rawSql: |
                WITH recent_trade AS (
                  SELECT
                    te."timestamp" AS traded_at,
                    te."userId"::text AS user_id,
                    COALESCE(
                      u."telegramUsername",
                      u."telegramUserId"::text,
                      te."userId"::text,
                      'unknown'
                    ) AS user_handle,
                    COALESCE(te."marketSlug", 'unknown') AS market_slug,
                    ABS(COALESCE(te."costOrProceeds", te.shares * te.price, 0)) AS trade_value
                  FROM "TradeExecution" te
                  LEFT JOIN "User" u ON u.id = te."userId"
                  WHERE te."timestamp" >= NOW() - INTERVAL '2 minutes'
                  ORDER BY te."timestamp" DESC
                  LIMIT 1
                )
                SELECT
                  recent_trade.traded_at AS "time",
                  CONCAT(
                    'user_id=', recent_trade.user_id,
                    ' | handle=', recent_trade.user_handle,
                    ' | market=', recent_trade.market_slug,
                    ' | amount_usd=', TO_CHAR(recent_trade.trade_value, 'FM999999990.999999')
                  ) AS metric,
                  1::double precision AS value
                FROM recent_trade
                ORDER BY 1;
              refId: D
          - refId: E
            relativeTimeRange:
              from: 0
              to: 0
            datasourceUid: __expr__
            model:
              datasource:
                type: __expr__
                uid: __expr__
              type: classic_conditions
              conditions:
                - evaluator:
                    params:
                      - 0
                    type: gt
                  operator:
                    type: and
                  query:
                    params:
                      - D
                  reducer:
                    type: last
                  type: query
              intervalMs: 1000
              maxDataPoints: 43200
        noDataState: OK
        executionErrorState: Error
        for: 0s
        annotations:
          summary: Polybot user executed a trade during the last 2 minutes
          details: Payload includes user_id, telegram handle, market slug, and USD notional amount

        labels:
          severity: info
          component: polybot-trade
        isPaused: false

      # -------------------------
      # 3. New user alert
      # -------------------------
      - uid: builtin_polybot_new_user
        interval: 30s
        title: Polybot New User Registered
        condition: H
        data:
          - refId: G
            relativeTimeRange:
              from: 60   # 1 minutes
              to: 0
            datasourceUid: grafana_postgres
            model:
              datasource:
                type: postgres
                uid: grafana_postgres
              format: time_series
              intervalMs: 1000
              maxDataPoints: 43200
              rawSql: |
                WITH new_users AS (
                  SELECT
                    u."createdAt" AS registered_at,
                    COALESCE(
                      u."telegramUsername",
                      u."telegramUserId"::text,
                      'unknown'
                    ) AS user_handle
                  FROM "User" u
                  WHERE u."createdAt" >= NOW() - INTERVAL '1 minutes'
                  ORDER BY u."createdAt" DESC
                  LIMIT 5
                )
                SELECT
                  COALESCE(MAX(new_users.registered_at), NOW()) AS "time",
                  CONCAT(
                    'count=', COUNT(*),
                    ' | users=', COALESCE(string_agg(new_users.user_handle, ', '), 'none')
                  ) AS metric,
                  COUNT(*)::double precision AS value
                FROM new_users;
              refId: G
          - refId: H
            relativeTimeRange:
              from: 0
              to: 0
            datasourceUid: __expr__
            model:
              datasource:
                type: __expr__
                uid: __expr__
              type: classic_conditions
              conditions:
                - evaluator:
                    params:
                      - 0
                    type: gt
                  operator:
                    type: and
                  query:
                    params:
                      - G
                  reducer:
                    type: last
                  type: query
              intervalMs: 1000
              maxDataPoints: 43200
        noDataState: OK
        executionErrorState: Error
        for: 0s
        annotations:
          summary: New Polybot user registered during the last 2 minutes
          details: Payload shows count and up to five newest user handles
        labels:
          severity: info
          component: polybot-user
        isPaused: false

```

## grafana/alerting/contact-points.yml

```
apiVersion: 1

contactPoints:
  # -------------------------
  # Flow errors → engineering Slack
  # -------------------------
  - orgId: 1
    name: polybot-flow-slack
    receivers:
      - uid: polybot_flow_slack
        type: slack
        disableResolveMessage: false
        settings:
          recipient: "${POLYBOT_SLACK_CHANNEL}"
          url: "${POLYBOT_SLACK_WEBHOOK_URL}"
          title: '{{ if .CommonLabels.alertname }}{{ .CommonLabels.alertname }}{{ else }}Grafana Alert{{ end }}'
          text: |
            {{- range .Alerts }}
            *Alert:* {{ if .Labels.alertname }}{{ .Labels.alertname }}{{ else }}Grafana Alert{{ end }}
            *Severity:* {{ if .Labels.severity }}{{ .Labels.severity }}{{ else }}n/a{{ end }}
            *Component:* {{ if .Labels.component }}{{ .Labels.component }}{{ else }}n/a{{ end }}
            {{- if .GeneratorURL }}
            *Alert URL:* <{{ .GeneratorURL }}|Open alert view>
            {{- end }}

            {{- if or .Annotations.metric .Annotations.value .Annotations.time }}
            *Metric:* {{ if .Annotations.metric }}{{ .Annotations.metric }}{{ else }}n/a{{ end }}
            {{- if .Annotations.value }}
            *Value:* {{ .Annotations.value }}
            {{- end }}
            {{- if .Annotations.time }}
            *Observed At:* {{ .Annotations.time }}
            {{- end }}
            {{- end }}

            {{- if .Annotations.summary }}
            *Summary:* {{ .Annotations.summary }}
            {{- end }}
            {{- if .Annotations.details }}
            *Details:* {{ .Annotations.details }}
            {{- end }}
            {{- end }}
          color: '{{ if eq .CommonLabels.severity "critical" }}#E02F44{{ else if or (eq .CommonLabels.severity "error") (eq .CommonLabels.severity "warning") }}#FFB347{{ else }}#36A64F{{ end }}'

  # -------------------------
  # Trades → business Slack
  # -------------------------
  - orgId: 1
    name: polybot-trade-slack
    receivers:
      - uid: polybot_trade_slack
        type: slack
        disableResolveMessage: false
        settings:
          recipient: "${POLYBOT_BUSINESS_SLACK_CHANNEL}"
          url: "${POLYBOT_BUSINESS_SLACK_WEBHOOK_URL}"
          title: '{{ if .CommonLabels.alertname }}{{ .CommonLabels.alertname }}{{ else }}Grafana Alert{{ end }}'
          text: |
            {{- range .Alerts.Firing }}
            *Polybot Trade Executed*

            Metric: {{ .Labels.metric }}
            Value: {{ index .Values "E" }}
            Observed At: {{ .StartsAt }}

            {{- end }}
          color: '{{ if eq .CommonLabels.severity "critical" }}#E02F44{{ else if or (eq .CommonLabels.severity "error") (eq .CommonLabels.severity "warning") }}#FFB347{{ else }}#36A64F{{ end }}'

  # -------------------------
  # New users → business Slack
  # -------------------------
  - orgId: 1
    name: polybot-user-slack
    receivers:
      - uid: polybot_user_slack
        type: slack
        disableResolveMessage: false
        settings:
          recipient: "${POLYBOT_BUSINESS_SLACK_CHANNEL}"
          url: "${POLYBOT_BUSINESS_SLACK_WEBHOOK_URL}"
          title: '{{ if .CommonLabels.alertname }}{{ .CommonLabels.alertname }}{{ else }}Grafana Alert{{ end }}'
          text: |
            {{- range .Alerts }}
            *Alert:* {{ if .Labels.alertname }}{{ .Labels.alertname }}{{ else }}Grafana Alert{{ end }}
            *Severity:* {{ if .Labels.severity }}{{ .Labels.severity }}{{ else }}n/a{{ end }}
            *Component:* {{ if .Labels.component }}{{ .Labels.component }}{{ else }}n/a{{ end }}
            {{- if .GeneratorURL }}
            *Alert URL:* <{{ .GeneratorURL }}|Open alert view>
            {{- end }}

            {{- if or .Annotations.metric .Annotations.value .Annotations.time }}
            *Metric:* {{ if .Annotations.metric }}{{ .Annotations.metric }}{{ else }}n/a{{ end }}
            {{- if .Annotations.value }}
            *Value:* {{ .Annotations.value }}
            {{- end }}
            {{- if .Annotations.time }}
            *Observed At:* {{ .Annotations.time }}
            {{- end }}
            {{- end }}

            {{- if .Annotations.summary }}
            *Summary:* {{ .Annotations.summary }}
            {{- end }}
            {{- if .Annotations.details }}
            *Details:* {{ .Annotations.details }}
            {{- end }}
            {{- end }}
          color: '{{ if eq .CommonLabels.severity "critical" }}#E02F44{{ else if or (eq .CommonLabels.severity "error") (eq .CommonLabels.severity "warning") }}#FFB347{{ else }}#36A64F{{ end }}'

```

## grafana/alerting/notification-policies.yml

```
apiVersion: 1

policies:
  - orgId: 1
    receiver: polybot-flow-slack
    groupBy:
      - alertname
    routes:
      - receiver: polybot-trade-slack
        matchers:
          - component=polybot-trade
      - receiver: polybot-user-slack
        matchers:
          - component=polybot-user

```

## grafana/dashboards.yml

```
apiVersion: 1

providers:
  - name: Built-in Dashboards
    orgId: 1
    folder: Observability
    type: file
    disableDeletion: false
    allowUiUpdates: true
    updateIntervalSeconds: 60
    options:
      path: /etc/grafana/provisioning/dashboards/builtin

```

## grafana/dashboards/polybot-business-dashboard.json

```
{
  "__inputs": [],
  "__elements": {},
  "__requires": [
    {
      "type": "grafana",
      "id": "grafana",
      "name": "Grafana",
      "version": "12.2.1"
    },
    {
      "type": "datasource",
      "id": "grafana-postgresql-datasource",
      "name": "PostgreSQL",
      "version": "12.2.1"
    },
    {
      "type": "panel",
      "id": "stat",
      "name": "Stat",
      "version": ""
    },
    {
      "type": "panel",
      "id": "table",
      "name": "Table",
      "version": ""
    },
    {
      "type": "panel",
      "id": "timeseries",
      "name": "Time series",
      "version": ""
    }
  ],
  "annotations": {
    "list": [
      {
        "builtIn": 1,
        "datasource": {
          "type": "grafana",
          "uid": "-- Grafana --"
        },
        "enable": true,
        "hide": true,
        "iconColor": "rgba(0, 211, 255, 1)",
        "name": "Annotations & Alerts",
        "type": "dashboard"
      }
    ]
  },
  "editable": true,
  "fiscalYearStartMonth": 0,
  "graphTooltip": 0,
  "links": [],
  "panels": [
    {
      "collapsed": false,
      "gridPos": {
        "h": 1,
        "w": 24,
        "x": 0,
        "y": 0
      },
      "id": 6,
      "panels": [],
      "title": "All time summary",
      "type": "row"
    },
    {
      "datasource": {
        "type": "grafana-postgresql-datasource",
        "uid": "grafana_postgres"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": 0
              }
            ]
          }
        },
        "overrides": []
      },
      "gridPos": {
        "h": 4,
        "w": 4,
        "x": 0,
        "y": 1
      },
      "id": 1,
      "options": {
        "colorMode": "value",
        "graphMode": "area",
        "justifyMode": "auto",
        "orientation": "auto",
        "percentChangeColorMode": "standard",
        "reduceOptions": {
          "calcs": [
            "lastNotNull"
          ],
          "fields": "",
          "values": false
        },
        "showPercentChange": false,
        "textMode": "auto",
        "wideLayout": true
      },
      "pluginVersion": "12.2.1",
      "targets": [
        {
          "dataset": "railway",
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "grafana_postgres"
          },
          "editorMode": "code",
          "format": "table",
          "rawQuery": true,
          "rawSql": "SELECT COUNT(id) FROM \"User\"",
          "refId": "A",
          "sql": {
            "columns": [
              {
                "name": "COUNT",
                "parameters": [
                  {
                    "name": "id",
                    "type": "functionParameter"
                  }
                ],
                "type": "function"
              }
            ],
            "groupBy": [
              {
                "property": {
                  "type": "string"
                },
                "type": "groupBy"
              }
            ],
            "limit": 50
          },
          "table": "\"User\""
        }
      ],
      "title": "All time users",
      "type": "stat"
    },
    {
      "datasource": {
        "type": "grafana-postgresql-datasource",
        "uid": "grafana_postgres"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": 0
              }
            ]
          },
          "unit": "currencyUSD"
        },
        "overrides": []
      },
      "gridPos": {
        "h": 4,
        "w": 4,
        "x": 4,
        "y": 1
      },
      "id": 8,
      "options": {
        "colorMode": "value",
        "graphMode": "area",
        "justifyMode": "auto",
        "orientation": "auto",
        "percentChangeColorMode": "standard",
        "reduceOptions": {
          "calcs": [
            "lastNotNull"
          ],
          "fields": "",
          "values": false
        },
        "showPercentChange": false,
        "textMode": "auto",
        "wideLayout": true
      },
      "pluginVersion": "12.2.1",
      "targets": [
        {
          "dataset": "railway",
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "grafana_postgres"
          },
          "editorMode": "code",
          "format": "table",
          "rawQuery": true,
          "rawSql": "SELECT COALESCE(SUM(\"amount\"), 0) AS \"feeEligibleVolume\"\n  FROM \"Transaction\"\n WHERE \"status\" = 'COMPLETED'\n    AND \"type\" IN ('TRADE_PRINCIPAL', 'REDEMPTION');",
          "refId": "A",
          "sql": {
            "columns": [
              {
                "parameters": [],
                "type": "function"
              }
            ],
            "groupBy": [
              {
                "property": {
                  "type": "string"
                },
                "type": "groupBy"
              }
            ],
            "limit": 50
          },
          "table": "\"Transaction\""
        }
      ],
      "title": "All time volume",
      "type": "stat"
    },
    {
      "datasource": {
        "type": "grafana-postgresql-datasource",
        "uid": "grafana_postgres"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": 0
              }
            ]
          },
          "unit": "currencyUSD"
        },
        "overrides": []
      },
      "gridPos": {
        "h": 4,
        "w": 4,
        "x": 8,
        "y": 1
      },
      "id": 2,
      "options": {
        "colorMode": "value",
        "graphMode": "area",
        "justifyMode": "auto",
        "orientation": "auto",
        "percentChangeColorMode": "standard",
        "reduceOptions": {
          "calcs": [
            "lastNotNull"
          ],
          "fields": "",
          "values": false
        },
        "showPercentChange": false,
        "textMode": "value",
        "wideLayout": true
      },
      "pluginVersion": "12.2.1",
      "targets": [
        {
          "dataset": "railway",
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "grafana_postgres"
          },
          "editorMode": "code",
          "format": "table",
          "rawQuery": true,
          "rawSql": "SELECT SUM(\"feeAmount\") FROM \"FeeAccrual\" WHERE status = 'SETTLED'",
          "refId": "A",
          "sql": {
            "columns": [
              {
                "name": "SUM",
                "parameters": [
                  {
                    "name": "\"feeAmount\"",
                    "type": "functionParameter"
                  }
                ],
                "type": "function"
              }
            ],
            "groupBy": [
              {
                "property": {
                  "type": "string"
                },
                "type": "groupBy"
              }
            ],
            "limit": 50
          },
          "table": "\"FeeAccrual\""
        }
      ],
      "title": "All time fees",
      "type": "stat"
    },
    {
      "datasource": {
        "type": "grafana-postgresql-datasource",
        "uid": "grafana_postgres"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": 0
              }
            ]
          },
          "unit": "currencyUSD"
        },
        "overrides": []
      },
      "gridPos": {
        "h": 4,
        "w": 4,
        "x": 12,
        "y": 1
      },
      "id": 50,
      "options": {
        "colorMode": "value",
        "graphMode": "area",
        "justifyMode": "auto",
        "orientation": "auto",
        "percentChangeColorMode": "standard",
        "reduceOptions": {
          "calcs": [
            "lastNotNull"
          ],
          "fields": "",
          "values": false
        },
        "showPercentChange": false,
        "textMode": "auto",
        "wideLayout": true
      },
      "pluginVersion": "12.2.1",
      "targets": [
        {
          "dataset": "railway",
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "grafana_postgres"
          },
          "editorMode": "code",
          "format": "table",
          "rawQuery": true,
          "rawSql": "SELECT\n  COALESCE(SUM(fe.\"volumeUsdc\"), 0) AS value\nFROM public.\"FillEvent\" fe\nJOIN public.\"Wallet\" w\n  ON LOWER(w.\"publicAddress\") = LOWER(fe.\"walletAddress\")\nWHERE fe.source = 'POLYMARKET_UI';",
          "refId": "A"
        }
      ],
      "title": "External Trading Volume (USDC)",
      "type": "stat"
    },
    {
      "collapsed": true,
      "gridPos": {
        "h": 1,
        "w": 24,
        "x": 0,
        "y": 5
      },
      "id": 9,
      "panels": [
        {
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "grafana_postgres"
          },
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "thresholds"
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": 0
                  },
                  {
                    "color": "red",
                    "value": 80
                  }
                ]
              }
            },
            "overrides": []
          },
          "gridPos": {
            "h": 4,
            "w": 4,
            "x": 0,
            "y": 10
          },
          "id": 3,
          "options": {
            "colorMode": "value",
            "graphMode": "area",
            "justifyMode": "auto",
            "orientation": "auto",
            "percentChangeColorMode": "standard",
            "reduceOptions": {
              "calcs": [
                "lastNotNull"
              ],
              "fields": "",
              "values": false
            },
            "showPercentChange": false,
            "textMode": "auto",
            "wideLayout": true
          },
          "pluginVersion": "12.2.1",
          "targets": [
            {
              "dataset": "railway",
              "datasource": {
                "type": "grafana-postgresql-datasource",
                "uid": "grafana_postgres"
              },
              "editorMode": "code",
              "format": "table",
              "rawQuery": true,
              "rawSql": "SELECT\n    COUNT(*) AS value\n  FROM \"User\"\n  WHERE \"createdAt\" >= NOW() - INTERVAL '24 hours';",
              "refId": "A",
              "sql": {
                "columns": [
                  {
                    "parameters": [],
                    "type": "function"
                  }
                ],
                "groupBy": [
                  {
                    "property": {
                      "type": "string"
                    },
                    "type": "groupBy"
                  }
                ],
                "limit": 50
              }
            }
          ],
          "title": "New users (24h)",
          "type": "stat"
        },
        {
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "grafana_postgres"
          },
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "thresholds"
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": 0
                  }
                ]
              },
              "unit": "currencyUSD"
            },
            "overrides": []
          },
          "gridPos": {
            "h": 4,
            "w": 4,
            "x": 4,
            "y": 10
          },
          "id": 10,
          "options": {
            "colorMode": "value",
            "graphMode": "area",
            "justifyMode": "auto",
            "orientation": "auto",
            "percentChangeColorMode": "standard",
            "reduceOptions": {
              "calcs": [
                "lastNotNull"
              ],
              "fields": "",
              "values": false
            },
            "showPercentChange": false,
            "text": {
              "titleSize": 1
            },
            "textMode": "auto",
            "wideLayout": true
          },
          "pluginVersion": "12.2.1",
          "targets": [
            {
              "dataset": "railway",
              "datasource": {
                "type": "grafana-postgresql-datasource",
                "uid": "grafana_postgres"
              },
              "editorMode": "code",
              "format": "table",
              "rawQuery": true,
              "rawSql": "SELECT COALESCE(SUM(\"amount\"), 0) AS \"feeEligibleVolume24h\"\nFROM \"Transaction\"\nWHERE \"status\" = 'COMPLETED'\nAND \"type\" IN ('TRADE_PRINCIPAL', 'REDEMPTION')\nAND \"timestamp\" >= NOW() - INTERVAL '24 hours';\n ",
              "refId": "A",
              "sql": {
                "columns": [
                  {
                    "parameters": [],
                    "type": "function"
                  }
                ],
                "groupBy": [
                  {
                    "property": {
                      "type": "string"
                    },
                    "type": "groupBy"
                  }
                ],
                "limit": 50
              }
            }
          ],
          "title": "24h Volume",
          "type": "stat"
        },
        {
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "grafana_postgres"
          },
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "thresholds"
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": 0
                  },
                  {
                    "color": "red",
                    "value": 80
                  }
                ]
              },
              "unit": "currencyUSD"
            },
            "overrides": []
          },
          "gridPos": {
            "h": 4,
            "w": 4,
            "x": 8,
            "y": 10
          },
          "id": 11,
          "options": {
            "colorMode": "value",
            "graphMode": "area",
            "justifyMode": "auto",
            "orientation": "auto",
            "percentChangeColorMode": "standard",
            "reduceOptions": {
              "calcs": [
                "lastNotNull"
              ],
              "fields": "",
              "values": false
            },
            "showPercentChange": false,
            "textMode": "auto",
            "wideLayout": true
          },
          "pluginVersion": "12.2.1",
          "targets": [
            {
              "dataset": "railway",
              "datasource": {
                "type": "grafana-postgresql-datasource",
                "uid": "grafana_postgres"
              },
              "editorMode": "code",
              "format": "table",
              "rawQuery": true,
              "rawSql": " SELECT COALESCE(SUM(\"feeAmount\"), 0) AS \"feeAmount24h\"\n  FROM \"FeeAccrual\"\n  WHERE \"status\" NOT IN ('FAILED', 'REVERSED')\n    AND \"accruedAt\" >= NOW() - INTERVAL '24 hours';",
              "refId": "A",
              "sql": {
                "columns": [
                  {
                    "parameters": [],
                    "type": "function"
                  }
                ],
                "groupBy": [
                  {
                    "property": {
                      "type": "string"
                    },
                    "type": "groupBy"
                  }
                ],
                "limit": 50
              }
            }
          ],
          "title": "24h Fees",
          "type": "stat"
        },
        {
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "grafana_postgres"
          },
          "fieldConfig": {
            "defaults": {
              "custom": {
                "align": "auto",
                "cellOptions": {
                  "type": "auto"
                },
                "footer": {
                  "reducers": []
                },
                "inspect": false,
                "filterable": true
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": 0
                  },
                  {
                    "color": "red",
                    "value": 80
                  }
                ]
              }
            },
            "overrides": []
          },
          "gridPos": {
            "h": 8,
            "w": 24,
            "x": 0,
            "y": 14
          },
          "id": 45,
          "options": {
            "cellHeight": "sm",
            "enablePagination": true,
            "showHeader": true
          },
          "pluginVersion": "12.2.1",
          "targets": [
            {
              "dataset": "railway",
              "datasource": {
                "type": "grafana-postgresql-datasource",
                "uid": "grafana_postgres"
              },
              "editorMode": "code",
              "format": "table",
              "rawQuery": true,
              "rawSql": "SELECT\n  u.id AS \"UserId\",\n  u.\"telegramUsername\" AS \"TelegramUsername\",\n  u.\"telegramUserId\" AS \"TelegramUserId\",\n  u.\"createdAt\" AS \"Date\"\nFROM public.\"User\" u\nWHERE\n  u.\"createdAt\" >= NOW() - INTERVAL '24 hours'\nORDER BY\n  u.\"createdAt\" DESC\nLIMIT 1000;",
              "refId": "A"
            }
          ],
          "title": "New Users (Today)",
          "type": "table"
        }
      ],
      "title": "24h Stats",
      "type": "row"
    },
    {
      "collapsed": true,
      "gridPos": {
        "h": 1,
        "w": 24,
        "x": 0,
        "y": 6
      },
      "id": 7,
      "panels": [
        {
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "grafana_postgres"
          },
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "palette-classic"
              },
              "custom": {
                "axisBorderShow": false,
                "axisCenteredZero": false,
                "axisColorMode": "text",
                "axisLabel": "",
                "axisPlacement": "auto",
                "barAlignment": 0,
                "barWidthFactor": 0.6,
                "drawStyle": "line",
                "fillOpacity": 0,
                "gradientMode": "none",
                "hideFrom": {
                  "legend": false,
                  "tooltip": false,
                  "viz": false
                },
                "insertNulls": false,
                "lineInterpolation": "linear",
                "lineWidth": 1,
                "pointSize": 5,
                "scaleDistribution": {
                  "type": "linear"
                },
                "showPoints": "auto",
                "showValues": false,
                "spanNulls": false,
                "stacking": {
                  "group": "A",
                  "mode": "none"
                },
                "thresholdsStyle": {
                  "mode": "off"
                }
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": 0
                  }
                ]
              }
            },
            "overrides": []
          },
          "gridPos": {
            "h": 6,
            "w": 8,
            "x": 0,
            "y": 15
          },
          "id": 4,
          "options": {
            "legend": {
              "calcs": [],
              "displayMode": "list",
              "placement": "bottom",
              "showLegend": true
            },
            "tooltip": {
              "hideZeros": false,
              "mode": "single",
              "sort": "none"
            }
          },
          "pluginVersion": "12.2.1",
          "targets": [
            {
              "dataset": "railway",
              "datasource": {
                "type": "grafana-postgresql-datasource",
                "uid": "grafana_postgres"
              },
              "editorMode": "code",
              "format": "table",
              "hide": false,
              "rawQuery": true,
              "rawSql": "SELECT\n    date_trunc('day', \"timestamp\") AS time,\n    COUNT(*) AS value\n  FROM \"Transaction\"\n  WHERE \"timestamp\" >= NOW() - INTERVAL '30 days'\n  GROUP BY time\n  ORDER BY time;",
              "refId": "A",
              "sql": {
                "columns": [
                  {
                    "parameters": [],
                    "type": "function"
                  }
                ],
                "groupBy": [
                  {
                    "property": {
                      "type": "string"
                    },
                    "type": "groupBy"
                  }
                ],
                "limit": 50
              }
            }
          ],
          "title": "Transactions/Day",
          "type": "timeseries"
        },
        {
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "grafana_postgres"
          },
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "palette-classic"
              },
              "custom": {
                "axisBorderShow": false,
                "axisCenteredZero": false,
                "axisColorMode": "text",
                "axisLabel": "",
                "axisPlacement": "auto",
                "barAlignment": 0,
                "barWidthFactor": 0.6,
                "drawStyle": "line",
                "fillOpacity": 0,
                "gradientMode": "none",
                "hideFrom": {
                  "legend": false,
                  "tooltip": false,
                  "viz": false
                },
                "insertNulls": false,
                "lineInterpolation": "linear",
                "lineWidth": 1,
                "pointSize": 5,
                "scaleDistribution": {
                  "type": "linear"
                },
                "showPoints": "auto",
                "showValues": false,
                "spanNulls": false,
                "stacking": {
                  "group": "A",
                  "mode": "none"
                },
                "thresholdsStyle": {
                  "mode": "off"
                }
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": 0
                  },
                  {
                    "color": "red",
                    "value": 80
                  }
                ]
              },
              "unit": "currencyUSD"
            },
            "overrides": []
          },
          "gridPos": {
            "h": 6,
            "w": 8,
            "x": 8,
            "y": 15
          },
          "id": 5,
          "options": {
            "legend": {
              "calcs": [],
              "displayMode": "list",
              "placement": "bottom",
              "showLegend": true
            },
            "tooltip": {
              "hideZeros": false,
              "mode": "single",
              "sort": "none"
            }
          },
          "pluginVersion": "12.2.1",
          "targets": [
            {
              "dataset": "railway",
              "datasource": {
                "type": "grafana-postgresql-datasource",
                "uid": "grafana_postgres"
              },
              "editorMode": "code",
              "format": "table",
              "rawQuery": true,
              "rawSql": "  SELECT\n    date_trunc('day', \"timestamp\") AS time,\n    SUM(\"amount\") AS value\n  FROM \"Transaction\"\n  WHERE \"timestamp\" >= NOW() - INTERVAL '30 days'\n  GROUP BY time\n  ORDER BY time;",
              "refId": "A",
              "sql": {
                "columns": [
                  {
                    "parameters": [],
                    "type": "function"
                  }
                ],
                "groupBy": [
                  {
                    "property": {
                      "type": "string"
                    },
                    "type": "groupBy"
                  }
                ],
                "limit": 50
              }
            }
          ],
          "title": "Tx Volume per day",
          "type": "timeseries"
        },
        {
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "grafana_postgres"
          },
          "fieldConfig": {
            "defaults": {
              "custom": {
                "align": "auto",
                "cellOptions": {
                  "type": "auto"
                },
                "footer": {
                  "reducers": []
                },
                "inspect": false,
                "filterable": true
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": 0
                  },
                  {
                    "color": "red",
                    "value": 80
                  }
                ]
              }
            },
            "overrides": []
          },
          "gridPos": {
            "h": 8,
            "w": 24,
            "x": 0,
            "y": 45
          },
          "id": 46,
          "options": {
            "cellHeight": "sm",
            "enablePagination": true,
            "showHeader": true
          },
          "pluginVersion": "12.2.1",
          "targets": [
            {
              "dataset": "railway",
              "datasource": {
                "type": "grafana-postgresql-datasource",
                "uid": "grafana_postgres"
              },
              "editorMode": "code",
              "format": "table",
              "rawQuery": true,
              "rawSql": "SELECT\n  u.id AS \"UserId\",\n  u.\"telegramUsername\" AS \"TelegramUsername\",\n  u.\"telegramUserId\" AS \"TelegramUserId\",\n  u.\"createdAt\" AS \"Date\"\nFROM public.\"User\" u\nWHERE\n  u.\"createdAt\" >= NOW() - INTERVAL '30 days'\nORDER BY\n  u.\"createdAt\" DESC\nLIMIT 1000;",
              "refId": "A"
            }
          ],
          "title": "New Users (30d)",
          "type": "table"
        }
      ],
      "title": "30d Charts",
      "type": "row"
    },
    {
      "collapsed": true,
      "gridPos": {
        "h": 1,
        "w": 24,
        "x": 0,
        "y": 7
      },
      "id": 12,
      "panels": [
        {
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "grafana_postgres"
          },
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "thresholds"
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": 0
                  },
                  {
                    "color": "red",
                    "value": 80
                  }
                ]
              }
            },
            "overrides": []
          },
          "gridPos": {
            "h": 4,
            "w": 4,
            "x": 0,
            "y": 34
          },
          "id": 13,
          "options": {
            "colorMode": "value",
            "graphMode": "area",
            "justifyMode": "auto",
            "orientation": "auto",
            "percentChangeColorMode": "standard",
            "reduceOptions": {
              "calcs": [
                "lastNotNull"
              ],
              "fields": "",
              "values": false
            },
            "showPercentChange": false,
            "textMode": "auto",
            "wideLayout": true
          },
          "pluginVersion": "12.2.1",
          "targets": [
            {
              "dataset": "railway",
              "datasource": {
                "type": "grafana-postgresql-datasource",
                "uid": "grafana_postgres"
              },
              "editorMode": "code",
              "format": "table",
              "rawQuery": true,
              "rawSql": "SELECT COUNT(DISTINCT \"userId\") FROM \"TradeExecution\";",
              "refId": "A"
            }
          ],
          "title": "Unique Traders (all time)",
          "type": "stat"
        },
        {
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "grafana_postgres"
          },
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "thresholds"
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": 0
                  },
                  {
                    "color": "red",
                    "value": 80
                  }
                ]
              }
            },
            "overrides": []
          },
          "gridPos": {
            "h": 4,
            "w": 4,
            "x": 4,
            "y": 34
          },
          "id": 14,
          "options": {
            "colorMode": "value",
            "graphMode": "area",
            "justifyMode": "auto",
            "orientation": "auto",
            "percentChangeColorMode": "standard",
            "reduceOptions": {
              "calcs": [
                "lastNotNull"
              ],
              "fields": "",
              "values": false
            },
            "showPercentChange": false,
            "textMode": "auto",
            "wideLayout": true
          },
          "pluginVersion": "12.2.1",
          "targets": [
            {
              "dataset": "railway",
              "datasource": {
                "type": "grafana-postgresql-datasource",
                "uid": "grafana_postgres"
              },
              "editorMode": "code",
              "format": "table",
              "rawQuery": true,
              "rawSql": "SELECT COUNT(DISTINCT \"userId\") FROM \"TradeExecution\" WHERE \"timestamp\" >= NOW() - INTERVAL '24 hours';",
              "refId": "A"
            }
          ],
          "title": "Unique Traders (24h)",
          "type": "stat"
        },
        {
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "grafana_postgres"
          },
          "fieldConfig": {
            "defaults": {
              "custom": {
                "align": "auto",
                "cellOptions": {
                  "type": "auto"
                },
                "footer": {
                  "reducers": []
                },
                "inspect": false,
                "filterable": true
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": 0
                  },
                  {
                    "color": "red",
                    "value": 80
                  }
                ]
              }
            },
            "overrides": []
          },
          "gridPos": {
            "h": 8,
            "w": 24,
            "x": 0,
            "y": 44
          },
          "id": 49,
          "options": {
            "cellHeight": "sm",
            "enablePagination": true,
            "showHeader": true
          },
          "pluginVersion": "12.2.1",
          "targets": [
            {
              "dataset": "railway",
              "datasource": {
                "type": "grafana-postgresql-datasource",
                "uid": "grafana_postgres"
              },
              "editorMode": "code",
              "format": "table",
              "rawQuery": true,
              "rawSql": "SELECT\n  te.\"userId\" AS \"UserId\",\n  COALESCE(u.\"telegramUsername\", u.\"telegramUserId\") AS \"TelegramUsername\",\n  SUM(ABS(COALESCE(te.\"costOrProceeds\", te.shares * te.price))) AS \"Total Trades Amount\"\nFROM public.\"TradeExecution\" te\nLEFT JOIN public.\"User\" u\n  ON u.id = te.\"userId\"\nWHERE\n  $__timeFilter(te.\"timestamp\")\nGROUP BY\n  te.\"userId\",\n  COALESCE(u.\"telegramUsername\", u.\"telegramUserId\")\nORDER BY\n  \"Total Trades Amount\" DESC\nLIMIT 100;",
              "refId": "A"
            }
          ],
          "title": "Top Traders",
          "type": "table"
        },
        {
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "grafana_postgres"
          },
          "fieldConfig": {
            "defaults": {
              "custom": {
                "align": "auto",
                "cellOptions": {
                  "type": "auto"
                },
                "footer": {
                  "reducers": []
                },
                "inspect": false,
                "filterable": true
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": 0
                  },
                  {
                    "color": "red",
                    "value": 80
                  }
                ]
              }
            },
            "overrides": []
          },
          "gridPos": {
            "h": 8,
            "w": 24,
            "x": 0,
            "y": 52
          },
          "id": 44,
          "options": {
            "cellHeight": "sm",
            "enablePagination": true,
            "showHeader": true
          },
          "pluginVersion": "12.2.1",
          "targets": [
            {
              "dataset": "railway",
              "datasource": {
                "type": "grafana-postgresql-datasource",
                "uid": "grafana_postgres"
              },
              "editorMode": "code",
              "format": "table",
              "rawQuery": true,
              "rawSql": "SELECT\n  te.\"userId\" AS \"UserId\",\n  u.\"telegramUsername\" AS \"TelegramUsername\",\n  te.\"marketSlug\" AS \"Market\",\n  COALESCE(te.\"costOrProceeds\", te.shares * te.price) AS \"Amount\",\n  te.\"timestamp\" AS \"Date\"\nFROM public.\"TradeExecution\" te\nLEFT JOIN public.\"User\" u\n  ON u.id = te.\"userId\"\nWHERE\n  $__timeFilter(te.\"timestamp\")\nORDER BY\n  te.\"timestamp\" DESC\nLIMIT 1000;",
              "refId": "A"
            }
          ],
          "title": "Recent Trades",
          "type": "table"
        },
        {
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "grafana_postgres"
          },
          "fieldConfig": {
            "defaults": {
              "custom": {
                "align": "auto",
                "cellOptions": {
                  "type": "auto"
                },
                "filterable": true,
                "footer": {
                  "reducers": []
                },
                "frozenColumns": 0,
                "inspect": false
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": 0
                  },
                  {
                    "color": "red",
                    "value": 80
                  }
                ]
              }
            },
            "overrides": []
          },
          "gridPos": {
            "h": 10,
            "w": 24,
            "x": 0,
            "y": 60
          },
          "id": 51,
          "options": {
            "cellHeight": "sm",
            "showHeader": true
          },
          "pluginVersion": "12.2.1",
          "targets": [
            {
              "datasource": {
                "type": "grafana-postgresql-datasource",
                "uid": "grafana_postgres"
              },
              "format": "table",
              "rawSql": "SELECT\n  u.id AS \"UserId\",\n  COALESCE(u.\"telegramUsername\", u.\"telegramUserId\") AS \"Telegram\",\n  fe.\"processedAt\" AS \"Processed At\",\n  fe.\"txHash\" AS \"Tx Hash\",\n  fe.\"volumeUsdc\" AS \"Volume (USDC)\"\nFROM public.\"FillEvent\" fe\nJOIN public.\"Wallet\" w\n  ON LOWER(w.\"publicAddress\") = LOWER(fe.\"walletAddress\")\nJOIN public.\"User\" u\n  ON u.id = w.\"userId\"\nWHERE\n  $__timeFilter(fe.\"processedAt\")\n  AND fe.source = 'POLYMARKET_UI'\nORDER BY\n  fe.\"processedAt\" DESC\nLIMIT 1000;",
              "refId": "A"
            }
          ],
          "title": "Trades Executed Outside Polybot",
          "type": "table"
        }
      ],
      "title": "Trading Metrics",
      "type": "row"
    },
    {
      "collapsed": true,
      "gridPos": {
        "h": 1,
        "w": 24,
        "x": 0,
        "y": 8
      },
      "id": 16,
      "panels": [
        {
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "grafana_postgres"
          },
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "palette-classic"
              },
              "custom": {
                "axisBorderShow": false,
                "axisCenteredZero": false,
                "axisColorMode": "text",
                "axisLabel": "",
                "axisPlacement": "auto",
                "barAlignment": 0,
                "barWidthFactor": 0.6,
                "drawStyle": "line",
                "fillOpacity": 0,
                "gradientMode": "none",
                "hideFrom": {
                  "legend": false,
                  "tooltip": false,
                  "viz": false
                },
                "insertNulls": false,
                "lineInterpolation": "linear",
                "lineWidth": 1,
                "pointSize": 5,
                "scaleDistribution": {
                  "type": "linear"
                },
                "showPoints": "auto",
                "showValues": false,
                "spanNulls": false,
                "stacking": {
                  "group": "A",
                  "mode": "none"
                },
                "thresholdsStyle": {
                  "mode": "off"
                }
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": 0
                  }
                ]
              }
            },
            "overrides": []
          },
          "gridPos": {
            "h": 6,
            "w": 12,
            "x": 0,
            "y": 39
          },
          "id": 17,
          "options": {
            "legend": {
              "calcs": [],
              "displayMode": "list",
              "placement": "bottom",
              "showLegend": true
            },
            "tooltip": {
              "hideZeros": false,
              "mode": "single",
              "sort": "none"
            }
          },
          "pluginVersion": "12.2.1",
          "targets": [
            {
              "dataset": "railway",
              "datasource": {
                "type": "grafana-postgresql-datasource",
                "uid": "grafana_postgres"
              },
              "editorMode": "code",
              "format": "table",
              "rawQuery": true,
              "rawSql": "SELECT date_trunc('day', \"timestamp\") AS time, \"side\", COUNT(*) AS value FROM \"TradeExecution\" WHERE \"timestamp\" >= NOW() - INTERVAL '30 days' GROUP BY 1,2 ORDER BY 1,2;",
              "refId": "A"
            }
          ],
          "title": "Trades by Side (30d)",
          "type": "timeseries"
        },
        {
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "grafana_postgres"
          },
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "palette-classic"
              },
              "custom": {
                "axisBorderShow": false,
                "axisCenteredZero": false,
                "axisColorMode": "text",
                "axisLabel": "",
                "axisPlacement": "auto",
                "barAlignment": 0,
                "barWidthFactor": 0.6,
                "drawStyle": "line",
                "fillOpacity": 0,
                "gradientMode": "none",
                "hideFrom": {
                  "legend": false,
                  "tooltip": false,
                  "viz": false
                },
                "insertNulls": false,
                "lineInterpolation": "linear",
                "lineWidth": 1,
                "pointSize": 5,
                "scaleDistribution": {
                  "type": "linear"
                },
                "showPoints": "auto",
                "showValues": false,
                "spanNulls": false,
                "stacking": {
                  "group": "A",
                  "mode": "none"
                },
                "thresholdsStyle": {
                  "mode": "off"
                }
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": 0
                  }
                ]
              },
              "unit": "currencyUSD"
            },
            "overrides": []
          },
          "gridPos": {
            "h": 6,
            "w": 12,
            "x": 12,
            "y": 39
          },
          "id": 18,
          "options": {
            "legend": {
              "calcs": [],
              "displayMode": "list",
              "placement": "bottom",
              "showLegend": true
            },
            "tooltip": {
              "hideZeros": false,
              "mode": "single",
              "sort": "none"
            }
          },
          "pluginVersion": "12.2.1",
          "targets": [
            {
              "dataset": "railway",
              "datasource": {
                "type": "grafana-postgresql-datasource",
                "uid": "grafana_postgres"
              },
              "editorMode": "code",
              "format": "table",
              "rawQuery": true,
              "rawSql": "SELECT date_trunc('day', \"timestamp\") AS time, AVG(\"costOrProceeds\") AS value FROM \"TradeExecution\" WHERE \"timestamp\" >= NOW() - INTERVAL '30 days' GROUP BY 1 ORDER BY 1;",
              "refId": "A"
            }
          ],
          "title": "Avg Order Size (30d)",
          "type": "timeseries"
        }
      ],
      "title": "Trading Charts (30d)",
      "type": "row"
    },
    {
      "collapsed": true,
      "gridPos": {
        "h": 1,
        "w": 24,
        "x": 0,
        "y": 9
      },
      "id": 19,
      "panels": [
        {
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "grafana_postgres"
          },
          "fieldConfig": {
            "defaults": {
              "custom": {
                "align": "auto",
                "cellOptions": {
                  "type": "auto"
                },
                "footer": {
                  "reducers": []
                },
                "inspect": false
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": 0
                  },
                  {
                    "color": "red",
                    "value": 80
                  }
                ]
              }
            },
            "overrides": []
          },
          "gridPos": {
            "h": 6,
            "w": 24,
            "x": 0,
            "y": 40
          },
          "id": 20,
          "options": {
            "cellHeight": "sm",
            "showHeader": true
          },
          "pluginVersion": "12.2.1",
          "targets": [
            {
              "dataset": "railway",
              "datasource": {
                "type": "grafana-postgresql-datasource",
                "uid": "grafana_postgres"
              },
              "editorMode": "code",
              "format": "table",
              "rawQuery": true,
              "rawSql": "SELECT \"marketSlug\", SUM(\"costOrProceeds\") AS value, COUNT(*) AS trades FROM \"TradeExecution\" WHERE \"timestamp\" >= NOW() - INTERVAL '7 days' GROUP BY 1 ORDER BY value DESC LIMIT 10;",
              "refId": "A"
            }
          ],
          "title": "Top Markets by Volume (7d)",
          "type": "table"
        }
      ],
      "title": "Markets (7d)",
      "type": "row"
    },
    {
      "collapsed": true,
      "gridPos": {
        "h": 1,
        "w": 24,
        "x": 0,
        "y": 10
      },
      "id": 21,
      "panels": [
        {
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "grafana_postgres"
          },
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "palette-classic"
              },
              "custom": {
                "axisBorderShow": false,
                "axisCenteredZero": false,
                "axisColorMode": "text",
                "axisLabel": "",
                "axisPlacement": "auto",
                "barAlignment": 0,
                "barWidthFactor": 0.6,
                "drawStyle": "line",
                "fillOpacity": 0,
                "gradientMode": "none",
                "hideFrom": {
                  "legend": false,
                  "tooltip": false,
                  "viz": false
                },
                "insertNulls": false,
                "lineInterpolation": "linear",
                "lineWidth": 1,
                "pointSize": 5,
                "scaleDistribution": {
                  "type": "linear"
                },
                "showPoints": "auto",
                "showValues": false,
                "spanNulls": false,
                "stacking": {
                  "group": "A",
                  "mode": "none"
                },
                "thresholdsStyle": {
                  "mode": "off"
                }
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": 0
                  }
                ]
              },
              "unit": "currencyUSD"
            },
            "overrides": []
          },
          "gridPos": {
            "h": 6,
            "w": 8,
            "x": 0,
            "y": 19
          },
          "id": 22,
          "options": {
            "legend": {
              "calcs": [],
              "displayMode": "list",
              "placement": "bottom",
              "showLegend": true
            },
            "tooltip": {
              "hideZeros": false,
              "mode": "single",
              "sort": "none"
            }
          },
          "pluginVersion": "12.2.1",
          "targets": [
            {
              "dataset": "railway",
              "datasource": {
                "type": "grafana-postgresql-datasource",
                "uid": "grafana_postgres"
              },
              "editorMode": "code",
              "format": "table",
              "rawQuery": true,
              "rawSql": "SELECT date_trunc('day', \"accruedAt\") AS time, SUM(\"feeAmount\") AS value FROM \"FeeAccrual\" GROUP BY 1 ORDER BY 1;",
              "refId": "A"
            }
          ],
          "title": "Fee Accruals (daily)",
          "type": "timeseries"
        },
        {
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "grafana_postgres"
          },
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "palette-classic"
              },
              "custom": {
                "axisBorderShow": false,
                "axisCenteredZero": false,
                "axisColorMode": "text",
                "axisLabel": "",
                "axisPlacement": "auto",
                "barAlignment": 0,
                "barWidthFactor": 0.6,
                "drawStyle": "line",
                "fillOpacity": 0,
                "gradientMode": "none",
                "hideFrom": {
                  "legend": false,
                  "tooltip": false,
                  "viz": false
                },
                "insertNulls": false,
                "lineInterpolation": "linear",
                "lineWidth": 1,
                "pointSize": 5,
                "scaleDistribution": {
                  "type": "linear"
                },
                "showPoints": "auto",
                "showValues": false,
                "spanNulls": false,
                "stacking": {
                  "group": "A",
                  "mode": "none"
                },
                "thresholdsStyle": {
                  "mode": "off"
                }
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": 0
                  }
                ]
              },
              "unit": "currencyUSD"
            },
            "overrides": []
          },
          "gridPos": {
            "h": 6,
            "w": 8,
            "x": 8,
            "y": 19
          },
          "id": 23,
          "options": {
            "legend": {
              "calcs": [],
              "displayMode": "list",
              "placement": "bottom",
              "showLegend": true
            },
            "tooltip": {
              "hideZeros": false,
              "mode": "single",
              "sort": "none"
            }
          },
          "pluginVersion": "12.2.1",
          "targets": [
            {
              "dataset": "railway",
              "datasource": {
                "type": "grafana-postgresql-datasource",
                "uid": "grafana_postgres"
              },
              "editorMode": "code",
              "format": "table",
              "rawQuery": true,
              "rawSql": "SELECT date_trunc('day', \"settledAt\") AS time, SUM(\"feeAmount\") AS value FROM \"FeeAccrual\" WHERE \"status\"='SETTLED' GROUP BY 1 ORDER BY 1;",
              "refId": "A"
            }
          ],
          "title": "Settled Fees (daily)",
          "type": "timeseries"
        },
        {
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "grafana_postgres"
          },
          "fieldConfig": {
            "defaults": {
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": 0
                  },
                  {
                    "color": "red",
                    "value": 80
                  }
                ]
              },
              "unit": "currencyUSD"
            },
            "overrides": []
          },
          "gridPos": {
            "h": 6,
            "w": 8,
            "x": 16,
            "y": 19
          },
          "id": 24,
          "options": {
            "colorMode": "value",
            "graphMode": "area",
            "justifyMode": "auto",
            "orientation": "auto",
            "percentChangeColorMode": "standard",
            "reduceOptions": {
              "calcs": [
                "lastNotNull"
              ],
              "fields": "",
              "values": false
            },
            "showPercentChange": false,
            "textMode": "auto",
            "wideLayout": true
          },
          "pluginVersion": "12.2.1",
          "targets": [
            {
              "dataset": "railway",
              "datasource": {
                "type": "grafana-postgresql-datasource",
                "uid": "grafana_postgres"
              },
              "editorMode": "code",
              "format": "table",
              "rawQuery": true,
              "rawSql": "SELECT COALESCE(SUM(\"feeAmount\"),0) FROM \"FeeAccrual\" WHERE \"status\"='ACCRUED';",
              "refId": "A"
            }
          ],
          "title": "Fee Backlog (now)",
          "type": "stat"
        }
      ],
      "title": "Fees",
      "type": "row"
    },
    {
      "collapsed": false,
      "gridPos": {
        "h": 1,
        "w": 24,
        "x": 0,
        "y": 11
      },
      "id": 25,
      "panels": [],
      "title": "Fee Backlog Details",
      "type": "row"
    },
    {
      "datasource": {
        "type": "grafana-postgresql-datasource",
        "uid": "grafana_postgres"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "custom": {
            "align": "auto",
            "cellOptions": {
              "type": "auto"
            },
            "footer": {
              "reducers": []
            },
            "inspect": false
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": 0
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          }
        },
        "overrides": []
      },
      "gridPos": {
        "h": 8,
        "w": 24,
        "x": 0,
        "y": 12
      },
      "id": 43,
      "options": {
        "cellHeight": "sm",
        "showHeader": true
      },
      "pluginVersion": "12.2.1",
      "targets": [
        {
          "dataset": "railway",
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "grafana_postgres"
          },
          "editorMode": "code",
          "format": "table",
          "rawQuery": true,
          "rawSql": "SELECT\n  fa.\"accruedAt\",\n  w.\"publicAddress\",\n  fa.\"feeAmount\",\n  fa.\"volumeUsdc\",\n  u.id AS \"userId\",\n  u.\"telegramUsername\"\nFROM public.\"FeeAccrual\" AS fa\nJOIN public.\"Wallet\"     AS w ON w.id     = fa.\"walletId\"\nJOIN public.\"User\"       AS u ON u.id     = w.\"userId\"\nWHERE fa.status = 'ACCRUED';",
          "refId": "A",
          "sql": {
            "columns": [
              {
                "parameters": [],
                "type": "function"
              }
            ],
            "groupBy": [
              {
                "property": {
                  "type": "string"
                },
                "type": "groupBy"
              }
            ],
            "limit": 50
          }
        }
      ],
      "title": "Pending Fees ",
      "type": "table"
    },
    {
      "datasource": {
        "type": "grafana-postgresql-datasource",
        "uid": "grafana_postgres"
      },
      "fieldConfig": {
        "defaults": {
          "custom": {
            "align": "auto",
            "cellOptions": {
              "type": "auto"
            },
            "footer": {
              "reducers": []
            },
            "inspect": false
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": 0
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          }
        },
        "overrides": []
      },
      "gridPos": {
        "h": 5,
        "w": 12,
        "x": 0,
        "y": 20
      },
      "id": 26,
      "options": {
        "cellHeight": "sm",
        "showHeader": true
      },
      "pluginVersion": "12.2.1",
      "targets": [
        {
          "dataset": "railway",
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "grafana_postgres"
          },
          "editorMode": "code",
          "format": "table",
          "rawQuery": true,
          "rawSql": "SELECT CASE WHEN NOW()-\"accruedAt\" < INTERVAL '1 day' THEN '<1d' WHEN NOW()-\"accruedAt\" < INTERVAL '3 days' THEN '1-3d' WHEN NOW()-\"accruedAt\" < INTERVAL '7 days' THEN '3-7d' ELSE '>7d' END AS bucket, SUM(\"feeAmount\") AS amount, COUNT(*) AS items FROM \"FeeAccrual\" WHERE \"status\"='ACCRUED' GROUP BY 1 ORDER BY 1;",
          "refId": "A"
        }
      ],
      "title": "Fee Backlog Aging",
      "type": "table"
    },
    {
      "collapsed": true,
      "gridPos": {
        "h": 1,
        "w": 24,
        "x": 0,
        "y": 25
      },
      "id": 28,
      "panels": [
        {
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "grafana_postgres"
          },
          "fieldConfig": {
            "defaults": {
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": 0
                  },
                  {
                    "color": "red",
                    "value": 80
                  }
                ]
              },
              "unit": "currencyUSD"
            },
            "overrides": []
          },
          "gridPos": {
            "h": 4,
            "w": 4,
            "x": 0,
            "y": 43
          },
          "id": 29,
          "options": {
            "colorMode": "value",
            "graphMode": "area",
            "justifyMode": "auto",
            "orientation": "auto",
            "percentChangeColorMode": "standard",
            "reduceOptions": {
              "calcs": [
                "lastNotNull"
              ],
              "fields": "",
              "values": false
            },
            "showPercentChange": false,
            "textMode": "auto",
            "wideLayout": true
          },
          "pluginVersion": "12.2.1",
          "targets": [
            {
              "dataset": "railway",
              "datasource": {
                "type": "grafana-postgresql-datasource",
                "uid": "grafana_postgres"
              },
              "editorMode": "code",
              "format": "table",
              "rawQuery": true,
              "rawSql": "SELECT COALESCE(SUM(\"amount\"),0) FROM \"Transaction\" WHERE \"type\"='WITHDRAWAL' AND \"status\"='COMPLETED' AND \"timestamp\" >= NOW() - INTERVAL '24 hours';",
              "refId": "A"
            }
          ],
          "title": "Withdrawals Volume (24h)",
          "type": "stat"
        },
        {
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "grafana_postgres"
          },
          "fieldConfig": {
            "defaults": {
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": 0
                  },
                  {
                    "color": "red",
                    "value": 80
                  }
                ]
              },
              "unit": "percent"
            },
            "overrides": []
          },
          "gridPos": {
            "h": 4,
            "w": 4,
            "x": 4,
            "y": 43
          },
          "id": 30,
          "options": {
            "colorMode": "value",
            "graphMode": "area",
            "justifyMode": "auto",
            "orientation": "auto",
            "percentChangeColorMode": "standard",
            "reduceOptions": {
              "calcs": [
                "lastNotNull"
              ],
              "fields": "",
              "values": false
            },
            "showPercentChange": false,
            "textMode": "auto",
            "wideLayout": true
          },
          "pluginVersion": "12.2.1",
          "targets": [
            {
              "dataset": "railway",
              "datasource": {
                "type": "grafana-postgresql-datasource",
                "uid": "grafana_postgres"
              },
              "editorMode": "code",
              "format": "table",
              "rawQuery": true,
              "rawSql": "SELECT COALESCE(100.0*SUM(CASE WHEN \"status\"='COMPLETED' THEN 1 ELSE 0 END)/NULLIF(SUM(CASE WHEN \"status\" IN ('COMPLETED','FAILED') THEN 1 ELSE 0 END),0),0) AS value FROM \"Transaction\" WHERE \"type\"='WITHDRAWAL' AND \"timestamp\" >= NOW() - INTERVAL '7 days';",
              "refId": "A"
            }
          ],
          "title": "Withdrawal Success Rate (7d)",
          "type": "stat"
        },
        {
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "grafana_postgres"
          },
          "fieldConfig": {
            "defaults": {
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": 0
                  },
                  {
                    "color": "red",
                    "value": 80
                  }
                ]
              },
              "unit": "s"
            },
            "overrides": []
          },
          "gridPos": {
            "h": 4,
            "w": 4,
            "x": 8,
            "y": 43
          },
          "id": 31,
          "options": {
            "colorMode": "value",
            "graphMode": "area",
            "justifyMode": "auto",
            "orientation": "auto",
            "percentChangeColorMode": "standard",
            "reduceOptions": {
              "calcs": [
                "lastNotNull"
              ],
              "fields": "",
              "values": false
            },
            "showPercentChange": false,
            "textMode": "auto",
            "wideLayout": true
          },
          "pluginVersion": "12.2.1",
          "targets": [
            {
              "dataset": "railway",
              "datasource": {
                "type": "grafana-postgresql-datasource",
                "uid": "grafana_postgres"
              },
              "editorMode": "code",
              "format": "table",
              "rawQuery": true,
              "rawSql": "SELECT EXTRACT(EPOCH FROM percentile_disc(0.5) WITHIN GROUP (ORDER BY (\"updatedAt\"-\"timestamp\"))) AS value FROM \"Transaction\" WHERE \"type\"='WITHDRAWAL' AND \"status\"='COMPLETED' AND \"timestamp\" >= NOW() - INTERVAL '7 days';",
              "refId": "A"
            }
          ],
          "title": "Withdrawal p50 Time (7d)",
          "type": "stat"
        },
        {
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "grafana_postgres"
          },
          "fieldConfig": {
            "defaults": {
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": 0
                  },
                  {
                    "color": "red",
                    "value": 80
                  }
                ]
              },
              "unit": "s"
            },
            "overrides": []
          },
          "gridPos": {
            "h": 4,
            "w": 4,
            "x": 12,
            "y": 43
          },
          "id": 32,
          "options": {
            "colorMode": "value",
            "graphMode": "area",
            "justifyMode": "auto",
            "orientation": "auto",
            "percentChangeColorMode": "standard",
            "reduceOptions": {
              "calcs": [
                "lastNotNull"
              ],
              "fields": "",
              "values": false
            },
            "showPercentChange": false,
            "textMode": "auto",
            "wideLayout": true
          },
          "pluginVersion": "12.2.1",
          "targets": [
            {
              "dataset": "railway",
              "datasource": {
                "type": "grafana-postgresql-datasource",
                "uid": "grafana_postgres"
              },
              "editorMode": "code",
              "format": "table",
              "rawQuery": true,
              "rawSql": "SELECT EXTRACT(EPOCH FROM percentile_disc(0.95) WITHIN GROUP (ORDER BY (\"updatedAt\"-\"timestamp\"))) AS value FROM \"Transaction\" WHERE \"type\"='WITHDRAWAL' AND \"status\"='COMPLETED' AND \"timestamp\" >= NOW() - INTERVAL '7 days';",
              "refId": "A"
            }
          ],
          "title": "Withdrawal p95 Time (7d)",
          "type": "stat"
        }
      ],
      "title": "Withdrawals",
      "type": "row"
    },
    {
      "collapsed": true,
      "gridPos": {
        "h": 1,
        "w": 24,
        "x": 0,
        "y": 26
      },
      "id": 33,
      "panels": [
        {
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "grafana_postgres"
          },
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "palette-classic"
              },
              "custom": {
                "axisBorderShow": false,
                "axisCenteredZero": false,
                "axisColorMode": "text",
                "axisLabel": "",
                "axisPlacement": "auto",
                "barAlignment": 0,
                "barWidthFactor": 0.6,
                "drawStyle": "line",
                "fillOpacity": 0,
                "gradientMode": "none",
                "hideFrom": {
                  "legend": false,
                  "tooltip": false,
                  "viz": false
                },
                "insertNulls": false,
                "lineInterpolation": "linear",
                "lineWidth": 1,
                "pointSize": 5,
                "scaleDistribution": {
                  "type": "linear"
                },
                "showPoints": "auto",
                "showValues": false,
                "spanNulls": false,
                "stacking": {
                  "group": "A",
                  "mode": "none"
                },
                "thresholdsStyle": {
                  "mode": "off"
                }
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": 0
                  }
                ]
              }
            },
            "overrides": []
          },
          "gridPos": {
            "h": 6,
            "w": 12,
            "x": 0,
            "y": 44
          },
          "id": 34,
          "options": {
            "legend": {
              "calcs": [],
              "displayMode": "list",
              "placement": "bottom",
              "showLegend": true
            },
            "tooltip": {
              "hideZeros": false,
              "mode": "single",
              "sort": "none"
            }
          },
          "pluginVersion": "12.2.1",
          "targets": [
            {
              "dataset": "railway",
              "datasource": {
                "type": "grafana-postgresql-datasource",
                "uid": "grafana_postgres"
              },
              "editorMode": "code",
              "format": "table",
              "rawQuery": true,
              "rawSql": "SELECT date_trunc('day', \"timestamp\") AS time, COUNT(*) AS value FROM \"Transaction\" WHERE \"type\"='WITHDRAWAL' AND \"timestamp\" >= NOW() - INTERVAL '30 days' GROUP BY 1 ORDER BY 1;",
              "refId": "A"
            }
          ],
          "title": "Withdrawals/Day (30d)",
          "type": "timeseries"
        },
        {
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "grafana_postgres"
          },
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "palette-classic"
              },
              "custom": {
                "axisBorderShow": false,
                "axisCenteredZero": false,
                "axisColorMode": "text",
                "axisLabel": "",
                "axisPlacement": "auto",
                "barAlignment": 0,
                "barWidthFactor": 0.6,
                "drawStyle": "line",
                "fillOpacity": 0,
                "gradientMode": "none",
                "hideFrom": {
                  "legend": false,
                  "tooltip": false,
                  "viz": false
                },
                "insertNulls": false,
                "lineInterpolation": "linear",
                "lineWidth": 1,
                "pointSize": 5,
                "scaleDistribution": {
                  "type": "linear"
                },
                "showPoints": "auto",
                "showValues": false,
                "spanNulls": false,
                "stacking": {
                  "group": "A",
                  "mode": "none"
                },
                "thresholdsStyle": {
                  "mode": "off"
                }
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": 0
                  }
                ]
              },
              "unit": "currencyUSD"
            },
            "overrides": []
          },
          "gridPos": {
            "h": 6,
            "w": 12,
            "x": 12,
            "y": 44
          },
          "id": 35,
          "options": {
            "legend": {
              "calcs": [],
              "displayMode": "list",
              "placement": "bottom",
              "showLegend": true
            },
            "tooltip": {
              "hideZeros": false,
              "mode": "single",
              "sort": "none"
            }
          },
          "pluginVersion": "12.2.1",
          "targets": [
            {
              "dataset": "railway",
              "datasource": {
                "type": "grafana-postgresql-datasource",
                "uid": "grafana_postgres"
              },
              "editorMode": "code",
              "format": "table",
              "rawQuery": true,
              "rawSql": "SELECT date_trunc('day', \"timestamp\") AS time, SUM(\"amount\") AS value FROM \"Transaction\" WHERE \"type\"='WITHDRAWAL' AND \"status\"='COMPLETED' AND \"timestamp\" >= NOW() - INTERVAL '30 days' GROUP BY 1 ORDER BY 1;",
              "refId": "A"
            }
          ],
          "title": "Withdrawal Volume/Day (30d)",
          "type": "timeseries"
        }
      ],
      "title": "Withdrawals Charts",
      "type": "row"
    },
    {
      "collapsed": true,
      "gridPos": {
        "h": 1,
        "w": 24,
        "x": 0,
        "y": 27
      },
      "id": 36,
      "panels": [
        {
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "grafana_postgres"
          },
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "palette-classic"
              },
              "custom": {
                "axisBorderShow": false,
                "axisCenteredZero": false,
                "axisColorMode": "text",
                "axisLabel": "",
                "axisPlacement": "auto",
                "barAlignment": 0,
                "barWidthFactor": 0.6,
                "drawStyle": "line",
                "fillOpacity": 0,
                "gradientMode": "none",
                "hideFrom": {
                  "legend": false,
                  "tooltip": false,
                  "viz": false
                },
                "insertNulls": false,
                "lineInterpolation": "linear",
                "lineWidth": 1,
                "pointSize": 5,
                "scaleDistribution": {
                  "type": "linear"
                },
                "showPoints": "auto",
                "showValues": false,
                "spanNulls": false,
                "stacking": {
                  "group": "A",
                  "mode": "none"
                },
                "thresholdsStyle": {
                  "mode": "off"
                }
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": 0
                  }
                ]
              }
            },
            "overrides": []
          },
          "gridPos": {
            "h": 6,
            "w": 8,
            "x": 0,
            "y": 45
          },
          "id": 37,
          "options": {
            "legend": {
              "calcs": [],
              "displayMode": "list",
              "placement": "bottom",
              "showLegend": true
            },
            "tooltip": {
              "hideZeros": false,
              "mode": "single",
              "sort": "none"
            }
          },
          "pluginVersion": "12.2.1",
          "targets": [
            {
              "dataset": "railway",
              "datasource": {
                "type": "grafana-postgresql-datasource",
                "uid": "grafana_postgres"
              },
              "editorMode": "code",
              "format": "table",
              "rawQuery": true,
              "rawSql": "SELECT date_trunc('day', \"attributedAt\") AS time, COUNT(*) AS value FROM \"ReferralAttribution\" GROUP BY 1 ORDER BY 1;",
              "refId": "A"
            }
          ],
          "title": "Referral Attributions (daily)",
          "type": "timeseries"
        },
        {
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "grafana_postgres"
          },
          "fieldConfig": {
            "defaults": {
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": 0
                  },
                  {
                    "color": "red",
                    "value": 80
                  }
                ]
              },
              "unit": "currencyUSD"
            },
            "overrides": []
          },
          "gridPos": {
            "h": 6,
            "w": 8,
            "x": 8,
            "y": 45
          },
          "id": 38,
          "options": {
            "colorMode": "value",
            "graphMode": "area",
            "justifyMode": "auto",
            "orientation": "auto",
            "percentChangeColorMode": "standard",
            "reduceOptions": {
              "calcs": [
                "lastNotNull"
              ],
              "fields": "",
              "values": false
            },
            "showPercentChange": false,
            "textMode": "auto",
            "wideLayout": true
          },
          "pluginVersion": "12.2.1",
          "targets": [
            {
              "dataset": "railway",
              "datasource": {
                "type": "grafana-postgresql-datasource",
                "uid": "grafana_postgres"
              },
              "editorMode": "code",
              "format": "table",
              "rawQuery": true,
              "rawSql": "SELECT COALESCE(SUM(\"amount\"),0) FROM \"ReferralAccrual\" WHERE \"status\"='PENDING_CLAIM' AND \"matureAt\" <= NOW();",
              "refId": "A"
            }
          ],
          "title": "Referral Matured Pending (now)",
          "type": "stat"
        },
        {
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "grafana_postgres"
          },
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "palette-classic"
              },
              "custom": {
                "axisBorderShow": false,
                "axisCenteredZero": false,
                "axisColorMode": "text",
                "axisLabel": "",
                "axisPlacement": "auto",
                "barAlignment": 0,
                "barWidthFactor": 0.6,
                "drawStyle": "line",
                "fillOpacity": 0,
                "gradientMode": "none",
                "hideFrom": {
                  "legend": false,
                  "tooltip": false,
                  "viz": false
                },
                "insertNulls": false,
                "lineInterpolation": "linear",
                "lineWidth": 1,
                "pointSize": 5,
                "scaleDistribution": {
                  "type": "linear"
                },
                "showPoints": "auto",
                "showValues": false,
                "spanNulls": false,
                "stacking": {
                  "group": "A",
                  "mode": "none"
                },
                "thresholdsStyle": {
                  "mode": "off"
                }
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": 0
                  }
                ]
              }
            },
            "overrides": []
          },
          "gridPos": {
            "h": 6,
            "w": 8,
            "x": 16,
            "y": 45
          },
          "id": 39,
          "options": {
            "legend": {
              "calcs": [],
              "displayMode": "list",
              "placement": "bottom",
              "showLegend": true
            },
            "tooltip": {
              "hideZeros": false,
              "mode": "single",
              "sort": "none"
            }
          },
          "pluginVersion": "12.2.1",
          "targets": [
            {
              "dataset": "railway",
              "datasource": {
                "type": "grafana-postgresql-datasource",
                "uid": "grafana_postgres"
              },
              "editorMode": "code",
              "format": "table",
              "rawQuery": true,
              "rawSql": "SELECT d AS time, COALESCE(c,0) AS created, COALESCE(comp,0) AS completed FROM (SELECT generate_series(date_trunc('day', NOW()) - INTERVAL '30 days', date_trunc('day', NOW()), INTERVAL '1 day') AS d) days LEFT JOIN (SELECT date_trunc('day', \"createdAt\") AS t, COUNT(*) AS c FROM \"ReferralClaim\" GROUP BY 1) created ON created.t = days.d LEFT JOIN (SELECT date_trunc('day', \"completedAt\") AS t, COUNT(*) AS comp FROM \"ReferralClaim\" WHERE \"completedAt\" IS NOT NULL GROUP BY 1) completed ON completed.t = days.d ORDER BY time;",
              "refId": "A"
            }
          ],
          "title": "Referral Claims (created vs completed)",
          "type": "timeseries"
        },
        {
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "grafana_postgres"
          },
          "fieldConfig": {
            "defaults": {
              "custom": {
                "align": "auto",
                "cellOptions": {
                  "type": "auto"
                },
                "footer": {
                  "reducers": []
                },
                "inspect": false,
                "filterable": true
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": 0
                  },
                  {
                    "color": "red",
                    "value": 80
                  }
                ]
              }
            },
            "overrides": []
          },
          "gridPos": {
            "h": 8,
            "w": 12,
            "x": 0,
            "y": 51
          },
          "id": 47,
          "options": {
            "cellHeight": "sm",
            "enablePagination": true,
            "showHeader": true
          },
          "pluginVersion": "12.2.1",
          "targets": [
            {
              "dataset": "railway",
              "datasource": {
                "type": "grafana-postgresql-datasource",
                "uid": "grafana_postgres"
              },
              "editorMode": "code",
              "format": "table",
              "rawQuery": true,
              "rawSql": "SELECT\n  ra.\"attributedAt\" AS \"Attributed At\",\n  COALESCE(ref.\"telegramUsername\", ref.\"telegramUserId\") AS \"Referrer (Telegram)\",\n  COALESCE(referee.\"telegramUsername\", referee.\"telegramUserId\") AS \"Referee (Telegram)\",\n  ra.source AS \"Source\"\nFROM public.\"ReferralAttribution\" ra\nLEFT JOIN public.\"User\" ref\n  ON ref.id = ra.\"referrerUserId\"\nLEFT JOIN public.\"User\" referee\n  ON referee.id = ra.\"refereeUserId\"\nWHERE\n  $__timeFilter(ra.\"attributedAt\")\nORDER BY\n  ra.\"attributedAt\" DESC\nLIMIT 1000;",
              "refId": "A"
            }
          ],
          "title": "Latest Referrals",
          "type": "table"
        },
        {
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "grafana_postgres"
          },
          "fieldConfig": {
            "defaults": {
              "custom": {
                "align": "auto",
                "cellOptions": {
                  "type": "auto"
                },
                "footer": {
                  "reducers": []
                },
                "inspect": false,
                "filterable": true
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": 0
                  },
                  {
                    "color": "red",
                    "value": 80
                  }
                ]
              }
            },
            "overrides": []
          },
          "gridPos": {
            "h": 8,
            "w": 12,
            "x": 12,
            "y": 51
          },
          "id": 48,
          "options": {
            "cellHeight": "sm",
            "enablePagination": true,
            "showHeader": true
          },
          "pluginVersion": "12.2.1",
          "targets": [
            {
              "dataset": "railway",
              "datasource": {
                "type": "grafana-postgresql-datasource",
                "uid": "grafana_postgres"
              },
              "editorMode": "code",
              "format": "table",
              "rawQuery": true,
              "rawSql": "WITH level1 AS (\n  SELECT\n    ra.\"referrerUserId\" AS user_id,\n    COUNT(*) AS level1\n  FROM public.\"ReferralAttribution\" ra\n  GROUP BY\n    ra.\"referrerUserId\"\n),\nlevel2 AS (\n  SELECT\n    parent.\"referrerUserId\" AS user_id,\n    COUNT(*) AS level2\n  FROM public.\"ReferralAttribution\" parent\n  JOIN public.\"ReferralAttribution\" child\n    ON child.\"referrerUserId\" = parent.\"refereeUserId\"\n  GROUP BY\n    parent.\"referrerUserId\"\n),\nlevel3 AS (\n  SELECT\n    grandparent.\"referrerUserId\" AS user_id,\n    COUNT(*) AS level3\n  FROM public.\"ReferralAttribution\" grandparent\n  JOIN public.\"ReferralAttribution\" parent\n    ON parent.\"referrerUserId\" = grandparent.\"refereeUserId\"\n  JOIN public.\"ReferralAttribution\" child\n    ON child.\"referrerUserId\" = parent.\"refereeUserId\"\n  GROUP BY\n    grandparent.\"referrerUserId\"\n)\nSELECT\n  COALESCE(u.\"telegramUsername\", u.\"telegramUserId\") AS \"User\",\n  COALESCE(l1.level1, 0) AS \"Level 1\",\n  COALESCE(l2.level2, 0) AS \"Level 2\",\n  COALESCE(l3.level3, 0) AS \"Level 3\",\n  COALESCE(l1.level1, 0) + COALESCE(l2.level2, 0) + COALESCE(l3.level3, 0) AS \"Total\"\nFROM public.\"User\" u\nLEFT JOIN level1 l1 ON l1.user_id = u.id\nLEFT JOIN level2 l2 ON l2.user_id = u.id\nLEFT JOIN level3 l3 ON l3.user_id = u.id\nWHERE\n  COALESCE(l1.level1, 0) + COALESCE(l2.level2, 0) + COALESCE(l3.level3, 0) > 0\nORDER BY\n  \"Total\" DESC,\n  \"Level 1\" DESC,\n  \"Level 2\" DESC,\n  \"Level 3\" DESC\nLIMIT 100;",
              "refId": "A"
            }
          ],
          "title": "Referral Leaderboard (All time)",
          "type": "table"
        }
      ],
      "title": "Referrals",
      "type": "row"
    },
    {
      "collapsed": true,
      "gridPos": {
        "h": 1,
        "w": 24,
        "x": 0,
        "y": 28
      },
      "id": 40,
      "panels": [
        {
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "grafana_postgres"
          },
          "fieldConfig": {
            "defaults": {
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": 0
                  },
                  {
                    "color": "red",
                    "value": 80
                  }
                ]
              }
            },
            "overrides": []
          },
          "gridPos": {
            "h": 4,
            "w": 4,
            "x": 0,
            "y": 46
          },
          "id": 41,
          "options": {
            "colorMode": "value",
            "graphMode": "area",
            "justifyMode": "auto",
            "orientation": "auto",
            "percentChangeColorMode": "standard",
            "reduceOptions": {
              "calcs": [
                "lastNotNull"
              ],
              "fields": "",
              "values": false
            },
            "showPercentChange": false,
            "textMode": "auto",
            "wideLayout": true
          },
          "pluginVersion": "12.2.1",
          "targets": [
            {
              "dataset": "railway",
              "datasource": {
                "type": "grafana-postgresql-datasource",
                "uid": "grafana_postgres"
              },
              "editorMode": "code",
              "format": "table",
              "rawQuery": true,
              "rawSql": "SELECT \"lastProcessedBlock\" AS value FROM \"IndexerState\" LIMIT 1;",
              "refId": "A"
            }
          ],
          "title": "Indexer Last Processed Block",
          "type": "stat"
        },
        {
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "grafana_postgres"
          },
          "fieldConfig": {
            "defaults": {
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": 0
                  },
                  {
                    "color": "red",
                    "value": 80
                  }
                ]
              }
            },
            "overrides": []
          },
          "gridPos": {
            "h": 4,
            "w": 4,
            "x": 4,
            "y": 46
          },
          "id": 42,
          "options": {
            "colorMode": "value",
            "graphMode": "area",
            "justifyMode": "auto",
            "orientation": "auto",
            "percentChangeColorMode": "standard",
            "reduceOptions": {
              "calcs": [
                "lastNotNull"
              ],
              "fields": "",
              "values": false
            },
            "showPercentChange": false,
            "textMode": "auto",
            "wideLayout": true
          },
          "pluginVersion": "12.2.1",
          "targets": [
            {
              "dataset": "railway",
              "datasource": {
                "type": "grafana-postgresql-datasource",
                "uid": "grafana_postgres"
              },
              "editorMode": "code",
              "format": "table",
              "rawQuery": true,
              "rawSql": "SELECT (\"lastFinalizedBlock\"-\"lastProcessedBlock\") AS value FROM \"IndexerState\" LIMIT 1;",
              "refId": "A"
            }
          ],
          "title": "Indexer Lag (finalized - processed)",
          "type": "stat"
        }
      ],
      "title": "Indexer",
      "type": "row"
    }
  ],
  "schemaVersion": 42,
  "tags": ["polybot", "business"],
  "templating": {
    "list": []
  },
  "time": {
    "from": "now-30d",
    "to": "now"
  },
  "timepicker": {},
  "timezone": "browser",
  "title": "Polybot Business Dashboard",
  "uid": "polybot-business-dashbaord",
  "version": 5,
  "weekStart": "",
  "id": null
}

```

## grafana/dashboards/polybot-technical-dashboard.json

```
{
  "__inputs": [],
  "__requires": [
    {
      "type": "grafana",
      "id": "grafana",
      "name": "Grafana",
      "version": "12.2.1"
    },
    {
      "type": "datasource",
      "id": "marcusolsson-json-datasource",
      "name": "JSON API",
      "version": "1.3.24"
    },
    {
      "type": "datasource",
      "id": "prometheus",
      "name": "Prometheus",
      "version": "1.0.0"
    },
    {
      "type": "panel",
      "id": "table",
      "name": "Table",
      "version": ""
    },
    {
      "type": "panel",
      "id": "timeseries",
      "name": "Time series",
      "version": ""
    },
    {
      "type": "panel",
      "id": "barchart",
      "name": "Bar chart",
      "version": ""
    },
    {
      "type": "panel",
      "id": "logs",
      "name": "Logs",
      "version": ""
    }
  ],
  "title": "PolyBot Technical Dashboard",
  "uid": "polybot-technical-dashboard",
  "version": 1,
  "refresh": "30s",
  "style": "dark",
  "tags": [
    "polybot",
    "technical"
  ],
  "annotations": {
    "list": []
  },
  "templating": {
    "list": []
  },
  "time": {
    "from": "now-6h",
    "to": "now"
  },
  "timepicker": {
    "refresh_intervals": [
      "15s",
      "30s",
      "1m",
      "5m",
      "10m",
      "30m",
      "1h"
    ]
  },
  "panels": [
    {
      "type": "stat",
      "title": "Service Overview",
      "gridPos": {
        "h": 8,
        "w": 12,
        "x": 12,
        "y": 0
      },
      "options": {
        "orientation": "horizontal",
        "textMode": "value_and_name",
        "justifyMode": "auto",
        "colorMode": "value",
        "graphMode": "none",
        "reduceOptions": {
          "calcs": [
            "lastNotNull"
          ],
          "fields": "/.*/",
          "values": false
        }
      },
      "fieldConfig": {
        "defaults": {
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "value": null,
                "color": "green"
              }
            ]
          }
        },
        "overrides": []
      },
      "targets": [
        {
          "refId": "A",
          "datasource": {
            "type": "marcusolsson-json-datasource",
            "uid": "polybot_json"
          },
          "jsonPath": "$",
          "method": "GET",
          "fields": [
            {
              "jsonPath": "$.service.environment",
              "name": "Environment"
            },
            {
              "jsonPath": "$.service.nodeVersion",
              "name": "Node Version"
            },
            {
              "jsonPath": "$.service.startedAtIso",
              "name": "Started At"
            },
            {
              "jsonPath": "$.service.uptimeSeconds",
              "name": "Uptime (s)"
            },
            {
              "jsonPath": "$.service.config.tradingFeeBps",
              "name": "Trading Fee (bps)"
            },
            {
              "jsonPath": "$.service.config.settlementIntervalMinutes",
              "name": "Settlement Interval (m)"
            }
          ]
        }
      ]
    },
    {
      "type": "timeseries",
      "title": "System Utilization",
      "gridPos": {
        "h": 8,
        "w": 12,
        "x": 0,
        "y": 0
      },
      "options": {
        "legend": {
          "displayMode": "list",
          "placement": "bottom",
          "calcs": []
        },
        "tooltip": {
          "mode": "multi",
          "sort": "desc"
        }
      },
      "fieldConfig": {
        "defaults": {
          "min": 0,
          "max": 100,
          "unit": "percent",
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "drawStyle": "line",
            "lineInterpolation": "smooth",
            "lineWidth": 2,
            "pointSize": 2,
            "gradientMode": "none",
            "fillOpacity": 10,
            "thresholdsStyle": {
              "mode": "off"
            }
          }
        },
        "overrides": []
      },
      "targets": [
        {
          "refId": "A",
          "datasource": {
            "type": "prometheus",
            "uid": "grafana_prometheus"
          },
          "expr": "clamp_max(100 * rate(process_cpu_seconds_total{app=\"polybot\"}[5m]), 100)",
          "legendFormat": "CPU %",
          "range": true,
          "instant": false
        },
        {
          "refId": "B",
          "datasource": {
            "type": "prometheus",
            "uid": "grafana_prometheus"
          },
          "expr": "clamp_max(100 * process_resident_memory_bytes{app=\"polybot\"} / (1024 * 1024 * 1024 * 32), 100)",
          "legendFormat": "Memory %",
          "range": true,
          "instant": false
        }
      ]
    },
    {
      "type": "table",
      "title": "Flow Alerts",
      "gridPos": {
        "h": 8,
        "w": 24,
        "x": 0,
        "y": 8
      },
      "targets": [
        {
          "refId": "A",
          "datasource": {
            "type": "postgres",
            "uid": "grafana_postgres"
          },
          "format": "table",
          "rawSql": "WITH fe AS ( SELECT \"createdAt\", \"flow\", \"stage\", \"level\", \"message\", (\"context\"::jsonb ->> 'userId')     AS user_id, (\"context\"::jsonb ->> 'marketSlug') AS market FROM \"FlowEvent\" ) SELECT fe.\"createdAt\" AS \"time\", fe.\"flow\"      AS \"Flow\", fe.user_id     AS \"UserId\", u.\"telegramUsername\" AS \"TelegramUsername\", fe.\"stage\"     AS \"Stage\", fe.\"level\"     AS \"Level\", fe.\"message\"   AS \"Details\", fe.market      AS \"Market\" FROM fe LEFT JOIN public.\"User\" u ON u.id::text = fe.user_id ORDER BY \"time\" DESC LIMIT 200;",
          "intervalFactor": 1
        }
      ],
      "options": {
        "showHeader": true,
        "cellHeight": "sm"
      }
    },
    {
      "type": "barchart",
      "title": "Error Volume (Logs)",
      "gridPos": {
        "h": 8,
        "w": 24,
        "x": 0,
        "y": 16
      },
      "options": {
        "xTickLabelSpacing": -100,
        "showValue": "auto",
        "stacking": "none",
        "tooltip": {
          "mode": "multi",
          "sort": "desc"
        },
        "legend": {
          "displayMode": "list",
          "placement": "bottom",
          "calcs": []
        },
        "xAxis": {
          "mode": "time",
          "show": true,
          "labelSpacing": "small",
          "placement": "bottom",
          "align": "auto"
        },
        "yAxis": {
          "scale": "linear"
        }
      },
      "fieldConfig": {
        "defaults": {
          "unit": "short",
          "color": {
            "mode": "fixed",
            "fixedColor": "#E02F44"
          },
          "custom": {
            "drawStyle": "bars",
            "lineInterpolation": "stepAfter",
            "lineWidth": 0,
            "fillOpacity": 85,
            "gradientMode": "none",
            "stacking": {
              "mode": "normal",
              "group": "A"
            },
            "barAlignment": 0,
            "barWidthFactor": 0.9,
            "showPoints": "never",
            "thresholdsStyle": {
              "mode": "off"
            },
            "nullValueMode": "zero"
          }
        },
        "overrides": []
      },
      "targets": [
        {
          "refId": "A",
          "datasource": {
            "type": "loki",
            "uid": "grafana_lokiq"
          },
          "expr": "sum by(level) ( count_over_time({service_name=\"polybot\"} | level=\"error\" [$__interval]) ) or vector(0)",
          "legendFormat": "{{level}}",
          "range": true,
          "instant": false
        }
      ]
    },
    {
      "type": "logs",
      "title": "Recent Errors (Logs)",
      "gridPos": {
        "h": 8,
        "w": 24,
        "x": 0,
        "y": 24
      },
      "options": {
        "dedupStrategy": "none",
        "enableLogDetails": true,
        "showLabels": false,
        "wrapLogMessage": true,
        "showTime": true,
        "timezone": "browser",
        "sortOrder": "Descending",
        "maxLines": 100
      },
      "targets": [
        {
          "refId": "A",
          "datasource": {
            "type": "loki",
            "uid": "grafana_lokiq"
          },
          "expr": "{service_name=\"polybot\"} | level=\"error\""
        }
      ]
    },
    {
      "type": "table",
      "title": "Settlements & Withdrawals",
      "gridPos": {
        "h": 8,
        "w": 12,
        "x": 0,
        "y": 32
      },
      "targets": [
        {
          "refId": "A",
          "datasource": {
            "type": "marcusolsson-json-datasource",
            "uid": "polybot_json"
          },
          "jsonPath": "$",
          "method": "GET",
          "fields": [
            {
              "jsonPath": "$.settlements.pendingSettlements",
              "name": "Pending Settlements"
            },
            {
              "jsonPath": "$.settlements.pendingAmountUsdc",
              "name": "Pending Fees (USDC)"
            },
            {
              "jsonPath": "$.settlements.settledToday",
              "name": "Settled Today"
            },
            {
              "jsonPath": "$.settlements.settledAmountToday",
              "name": "Settled Amount Today"
            },
            {
              "jsonPath": "$.withdrawals.pending.count",
              "name": "Pending Withdrawals"
            },
            {
              "jsonPath": "$.withdrawals.pending.amount",
              "name": "Pending Amount"
            },
            {
              "jsonPath": "$.withdrawals.failed24h.count",
              "name": "Failed Withdrawals (24h)"
            },
            {
              "jsonPath": "$.withdrawals.failed24h.amount",
              "name": "Failed Amount (24h)"
            }
          ]
        }
      ]
    },
    {
      "type": "table",
      "title": "Queues",
      "gridPos": {
        "h": 8,
        "w": 12,
        "x": 12,
        "y": 32
      },
      "targets": [
        {
          "refId": "A",
          "datasource": {
            "type": "marcusolsson-json-datasource",
            "uid": "polybot_json"
          },
          "jsonPath": "$",
          "method": "GET",
          "fields": [
            {
              "jsonPath": "$.queues.withdrawal.waiting",
              "name": "Withdrawal Waiting"
            },
            {
              "jsonPath": "$.queues.withdrawal.failed",
              "name": "Withdrawal Failed"
            },
            {
              "jsonPath": "$.queues.swap.waiting",
              "name": "Swap Waiting"
            },
            {
              "jsonPath": "$.queues.swap.failed",
              "name": "Swap Failed"
            },
            {
              "jsonPath": "$.queues.settlement.waiting",
              "name": "Settlement Waiting"
            },
            {
              "jsonPath": "$.queues.settlement.failed",
              "name": "Settlement Failed"
            }
          ]
        }
      ]
    }
  ]
}

```

## grafana/datasources/datasources.yml

```
# Configuration file version
# See here fore more information on configuration:
# https://grafana.com/docs/grafana/latest/administration/provisioning/#example-data-source-configuration-file
apiVersion: 1

# Mark provisioned data sources for deletion if they are no longer in a provisioning file.
prune: false

# List of data sources to insert/update depending on what's available.
datasources:
  - name: Loki
    type: loki
    access: proxy
    orgId: 1
    uid: grafana_lokiq
    url: ${LOKI_INTERNAL_URL}
    user:
    database:
    basicAuth:
    basicAuthUser:
    withCredentials:
    isDefault: true
  - name: Prometheus
    type: prometheus
    access: proxy
    orgId: 1
    uid: grafana_prometheus
    url: ${PROMETHEUS_INTERNAL_URL}
    user:
    database:
    basicAuth:
    basicAuthUser:
    withCredentials:
    isDefault: false
  - name: Tempo
    type: tempo
    access: proxy
    orgId: 1
    uid: grafana_tempo
    url: ${TEMPO_INTERNAL_URL}
    user:
    database:
    basicAuth:
    basicAuthUser:
    withCredentials:
    isDefault: false
  - name: Polybot PostgreSQL
    type: postgres
    access: proxy
    orgId: 1
    uid: grafana_postgres
    url: ${POSTGRES_DS_HOST}:5432
    user: ${POSTGRES_DS_USER}
    database: ${POSTGRES_DS_DATABASE}
    jsonData:
      database: ${POSTGRES_DS_DATABASE}
      sslmode: require
    secureJsonData:
      password: ${POSTGRES_DS_PASSWORD}
    isDefault: false
  - name: Polybot JSON API
    type: marcusolsson-json-datasource
    access: proxy
    orgId: 1
    uid: polybot_json
    url: ${POLYBOT_JSON_URL}
    isDefault: false
    jsonData:
      httpHeaderName1: Authorization
    secureJsonData:
      httpHeaderValue1: Bearer ${POLYBOT_METRICS_TOKEN}


```

## grafana/dockerfile

```
ARG VERSION=11.5.2

FROM grafana/grafana-oss:${VERSION}

COPY --chown=472:472 datasources /etc/grafana/provisioning/datasources
# copy provisioning configs and bundled dashboards
COPY --chown=472:472 dashboards.yml /etc/grafana/provisioning/dashboards/dashboards.yml
COPY --chown=472:472 dashboards /etc/grafana/provisioning/dashboards/builtin
COPY --chown=472:472 alerting /etc/grafana/provisioning/alerting

```

## loki/dockerfile

```
ARG VERSION=3.4

FROM grafana/loki:${VERSION}

# Copy the loki.yml configuration file to the container
COPY loki.yml /etc/loki/loki-config.yaml

# Ensure required storage directories exist and are writable by the loki user (10001)
RUN mkdir -p /loki/chunks /loki/tsdb-index /loki/tsdb-cache && \
    chown -R 10001:10001 /loki

# Railway detects service ports from EXPOSE; publish HTTP and gRPC
EXPOSE 3100 9095

# Command to run Loki
CMD ["-config.file=/etc/loki/loki-config.yaml", "-log.level=warn"]

```

## loki/loki.yml

```
auth_enabled: false

server:
  http_listen_port: 3100
  http_listen_address: 0.0.0.0
  grpc_listen_port: 9095
  grpc_listen_address: 0.0.0.0
  log_level: info

common:
  ring:
    instance_addr: 127.0.0.1
    kvstore:
      store: inmemory
  replication_factor: 1
  path_prefix: /loki

schema_config:
  configs:
  - from: 2023-01-01
    index:
      period: 24h
      prefix: index_
    store: tsdb
    object_store: filesystem
    schema: v13

storage_config:
  filesystem:
    directory: /loki/chunks
  tsdb_shipper:
    active_index_directory: /loki/tsdb-index
    cache_location: /loki/tsdb-cache

```

## prometheus/dockerfile

```
ARG VERSION=v3.2.1

FROM prom/prometheus:${VERSION}

# Copy the prom.yml configuration file to the container
COPY prom.yml /etc/prometheus/prom.yml

# Command to run Prometheus
CMD ["--config.file=/etc/prometheus/prom.yml", "--storage.tsdb.path=/prometheus"]
```

## prometheus/prom.yml

```
global:
  scrape_interval: 15s

scrape_configs:
  - job_name: prometheus
    static_configs:
      - targets:
          - localhost:9090

  - job_name: polybot
    scrape_interval: 15s
    metrics_path: /metrics
    scheme: http
    authorization:
      type: Bearer
      credentials: fQ9mT2ZvH6kP1sXgPolyBot
    static_configs:
      - targets:
          - polybot.railway.internal:3000
        labels:
          job: polybot
          service_name: polybot

  # - job_name: example_api
  #   scheme: http
  #   static_configs:
  #     - targets:
  #         - example_api:9091

  # - job_name: your-job-name
  #   scheme: https
  #   static_configs:
  #     - targets:
  #         - URL_GOES_HERE
  #   basic_auth:
  #     username: HTTP_AUTH_USERNAME_GOES_HERE
  #     password: HTTP_AUTH_PASSWORD_GOES_HERE

```

## tempo/dockerfile

```
ARG VERSION=latest

FROM grafana/tempo:${VERSION}

COPY tempo.yml /etc/tempo/tempo.yml

CMD ["-config.file=/etc/tempo/tempo.yml"]
```

## tempo/tempo.yml

```
server:
  http_listen_port: 3200

compactor:
  compaction:
    compaction_window: 1h

storage:
  trace:
    backend: local
    local:
      path: /var/tempo/traces

distributor:
  log_received_spans:
        enabled: true
  receivers:
    otlp:
      protocols:
        grpc:
          endpoint: "0.0.0.0:4317"
        http:
          endpoint: "0.0.0.0:4318"
```

</codebase>